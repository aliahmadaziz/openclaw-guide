{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"OpenClaw Installation Guide","text":"<p>An idiot-proof, copy-paste guide to setting up a hardened, production-ready OpenClaw AI assistant from zero in 3-4 hours.</p>"},{"location":"#what-is-openclaw","title":"What is OpenClaw?","text":"<p>OpenClaw connects AI models (Claude, Gemini, etc.) to messaging platforms (WhatsApp, Telegram, Discord) with persistent memory, automation, and tool use. Think of it as your personal AI assistant that lives in your chat.</p>"},{"location":"#what-this-guide-covers","title":"What This Guide Covers","text":"Part Topic Time What You Get Part 1 Base Install 30 min Hardened VPS + OpenClaw + WhatsApp connected Part 2 Your AI Assistant 30 min Persona, models, workspace configured Part 3 Infrastructure 1 hr Google OAuth, webhooks, Cloudflare tunnel, backups Part 4 Automation 1 hr Cron jobs, event queue, reminders, heartbeats Part 5 Hardening 30 min CrowdSec, secret rotation, snapshots, recovery Part 6 Verification 15 min 21-point validation + troubleshooting"},{"location":"#prerequisites","title":"Prerequisites","text":"<ul> <li>A VPS (guide uses Hetzner CX22 \u2014 2 vCPU, 4GB RAM, ~\u20ac4/mo)</li> <li>A WhatsApp account for bot pairing</li> <li>API keys for Anthropic and/or Google AI</li> <li>A domain name (for webhooks via Cloudflare tunnel)</li> <li>~3-4 hours of uninterrupted time</li> </ul>"},{"location":"#design-principles","title":"Design Principles","text":"<ul> <li>Linear, no branching \u2014 One path, one outcome. No \"if you want X, do Y.\"</li> <li>Copy-paste ready \u2014 Every command block can be pasted directly into terminal.</li> <li>Verification checkpoints \u2014 Each step ends with a \u2705 check before moving on.</li> <li>Production-hardened \u2014 Not a toy setup. Firewall, intrusion detection, encrypted backups, 3-tier recovery.</li> </ul>"},{"location":"#what-you-end-up-with","title":"What You End Up With","text":"<ul> <li>\ud83e\udd16 AI assistant in WhatsApp with custom personality</li> <li>\ud83d\udcc5 Google Calendar, Gmail, Drive integration</li> <li>\ud83d\udd04 Automated backups (hourly + nightly to encrypted Google Drive)</li> <li>\u23f0 Cron jobs, reminders, event queue with retry logic</li> <li>\ud83d\udee1\ufe0f CrowdSec intrusion detection, UFW firewall, SSH hardening</li> <li>\ud83d\udd11 Secret rotation schedule + automated alerts</li> <li>\ud83d\udcbe Config snapshots + 3-tier recovery (3 seconds to full restore)</li> <li>\u2705 21-point automated verification script</li> </ul>"},{"location":"#status","title":"Status","text":"<p>Last Updated: February 25, 2026 (OpenClaw 2026.2.24)</p> <p>This guide covers core setup and gets you to a fully working production system. Advanced hardening features (Chinese wall enforcement between work silos, automated config drift detection, cron backup guards) are documented in the codebase but not yet covered here. Core functionality is solid and battle-tested.</p>"},{"location":"#community","title":"Community","text":"<ul> <li>OpenClaw Docs: docs.openclaw.ai</li> <li>OpenClaw Source: github.com/openclaw/openclaw</li> <li>Discord: discord.com/invite/clawd</li> <li>Skills Marketplace: clawhub.com</li> </ul>"},{"location":"#credits","title":"Credits","text":"<p>Built by Ali Aziz with help from Moltbot \ud83e\udd9e</p> <p>Based on a real production setup running 24/7 since January 2026.</p>"},{"location":"#license","title":"License","text":"<p>MIT \u2014 use it, fork it, improve it.</p>"},{"location":"part1-base-install/","title":"OpenClaw Installation Guide - Part 1: Base Install (30 min)","text":"<p>Goal: Replicate a hardened OpenClaw setup on a fresh VPS. One path, one outcome.</p> <p>Prerequisites:  - SSH key pair on your local machine (<code>~/.ssh/id_rsa.pub</code>) - WhatsApp account for bot pairing</p>"},{"location":"part1-base-install/#1-vps-provisioning-hetzner-cloud","title":"1. VPS Provisioning (Hetzner Cloud)","text":""},{"location":"part1-base-install/#11-create-vps","title":"1.1 Create VPS","text":"<ol> <li>Login to Hetzner Cloud Console</li> <li>Create new project (or select existing)</li> <li>Click \"Add Server\"</li> <li>Configure:</li> <li>Location: Nuremberg (eu-central)</li> <li>Image: Ubuntu 24.04</li> <li>Type: CX22 (2 vCPU, 4GB RAM)</li> <li>SSH Keys: Add your public key (<code>~/.ssh/id_rsa.pub</code>)</li> <li>Name: openclaw-prod (or your choice)</li> <li>Click \"Create &amp; Buy Now\"</li> </ol> <p>\u2705 Verify: Server shows \"Running\" status, note the IP address</p>"},{"location":"part1-base-install/#12-initial-connection","title":"1.2 Initial Connection","text":"<pre><code>ssh root@YOUR_SERVER_IP\n</code></pre> <p>First connection will ask to verify fingerprint, type <code>yes</code></p> <p>\u2705 Verify: You're logged in as root, prompt shows <code>root@ubuntu-...</code></p>"},{"location":"part1-base-install/#2-ssh-hardening","title":"2. SSH Hardening","text":""},{"location":"part1-base-install/#21-configure-ssh-settings","title":"2.1 Configure SSH Settings","text":"<p>Edit SSH daemon config:</p> <pre><code>nano /etc/ssh/sshd_config\n</code></pre> <p>Find and change these lines (use Ctrl+W to search):</p> <pre><code>PermitRootLogin prohibit-password\nPasswordAuthentication no\nX11Forwarding no\n</code></pre> <p>Why: Key-only auth prevents brute force attacks, X11Forwarding reduces attack surface</p> <p>Save and exit (<code>Ctrl+X</code>, then <code>Y</code>, then <code>Enter</code>)</p>"},{"location":"part1-base-install/#22-restart-ssh","title":"2.2 Restart SSH","text":"<pre><code>systemctl restart sshd\n</code></pre> <p>Why: Apply new SSH security settings</p>"},{"location":"part1-base-install/#23-test-ssh-connection","title":"2.3 Test SSH Connection","text":"<p>Open a NEW terminal window (keep current session open):</p> <pre><code>ssh root@YOUR_SERVER_IP\n</code></pre> <p>\u2705 Verify: You can still login without password prompt. If this fails, debug in original window before closing it.</p>"},{"location":"part1-base-install/#3-os-hardening","title":"3. OS Hardening","text":""},{"location":"part1-base-install/#31-setup-firewall-ufw","title":"3.1 Setup Firewall (UFW)","text":"<pre><code>ufw default deny incoming\nufw default allow outgoing\nufw allow 22/tcp comment 'SSH'\nufw --force enable\n</code></pre> <p>Why: Default-deny firewall reduces exposure, only SSH port accessible</p> <p>\u2705 Verify: <code>ufw status</code> shows \"Status: active\" with SSH allowed</p>"},{"location":"part1-base-install/#32-remove-unnecessary-packages","title":"3.2 Remove Unnecessary Packages","text":"<pre><code>apt remove -y cups cups-daemon nginx docker.io docker-compose\napt autoremove -y\n</code></pre> <p>Why: Reduces attack surface and resource usage</p>"},{"location":"part1-base-install/#33-remove-snap-packages","title":"3.3 Remove Snap Packages","text":"<pre><code>snap list\nsnap remove chromium 2&gt;/dev/null || true\nsnap remove gnome-3-38-2004 2&gt;/dev/null || true\nsnap remove gnome-42-2204 2&gt;/dev/null || true\nsnap remove gtk-common-themes 2&gt;/dev/null || true\nsnap remove snap-store 2&gt;/dev/null || true\nsnap remove snapd-desktop-integration 2&gt;/dev/null || true\napt purge -y snapd\nrm -rf /snap /var/snap /var/lib/snapd\n</code></pre> <p>Why: Snap auto-updates can break production systems, not needed for server</p> <p>\u2705 Verify: <code>snap list</code> returns \"command not found\"</p>"},{"location":"part1-base-install/#34-add-swap-space","title":"3.4 Add Swap Space","text":"<pre><code>fallocate -l 2G /swapfile\nchmod 600 /swapfile\nmkswap /swapfile\nswapon /swapfile\necho '/swapfile none swap sw 0 0' &gt;&gt; /etc/fstab\n</code></pre> <p>Why: 2GB swap prevents OOM kills during memory spikes. OpenClaw with 200K context can spike to 3GB RAM usage with large Claude model responses.</p> <p>\u2705 Verify: <code>free -h</code> shows ~2G swap</p>"},{"location":"part1-base-install/#35-system-updates","title":"3.5 System Updates","text":"<pre><code>apt update\napt upgrade -y\napt autoremove -y\n</code></pre> <p>Why: Security patches and stability fixes</p> <p>\u2705 Verify: No errors, ends with \"0 upgraded, 0 newly installed\" on second run</p>"},{"location":"part1-base-install/#4-install-nodejs-22","title":"4. Install Node.js 22","text":""},{"location":"part1-base-install/#41-add-nodesource-repository","title":"4.1 Add NodeSource Repository","text":"<pre><code>curl -fsSL https://deb.nodesource.com/setup_22.x | bash -\n</code></pre> <p>Why: NodeSource provides official, up-to-date Node.js builds</p>"},{"location":"part1-base-install/#42-install-nodejs","title":"4.2 Install Node.js","text":"<pre><code>apt install -y nodejs\n</code></pre> <p>Why: OpenClaw requires Node.js runtime</p> <p>\u2705 Verify: <code>node --version</code> shows <code>v22.22.0</code> or later (minimum v22.x required), <code>npm --version</code> shows <code>10.x</code> or later</p>"},{"location":"part1-base-install/#5-install-openclaw","title":"5. Install OpenClaw","text":""},{"location":"part1-base-install/#51-install-via-npm","title":"5.1 Install via NPM","text":"<pre><code>npm install -g openclaw\n</code></pre> <p>Why: Global install makes <code>openclaw</code> command available system-wide</p> <p>\u2705 Verify: <code>openclaw --version</code> shows version 2026.2.x or later</p>"},{"location":"part1-base-install/#6-initial-setup","title":"6. Initial Setup","text":""},{"location":"part1-base-install/#61-run-setup-wizard","title":"6.1 Run Setup Wizard","text":"<pre><code>openclaw setup\n</code></pre> <p>Why: Configures WhatsApp connection and creates config file</p> <p>Follow the prompts:</p> <ol> <li>WhatsApp pairing method: Choose \"QR Code\" (option 1)</li> <li>QR Code will appear in terminal</li> <li>On your phone:</li> <li>Open WhatsApp</li> <li>Tap \u22ee (menu) \u2192 Linked Devices \u2192 Link a Device</li> <li>Scan the QR code from your terminal</li> <li>Wait for \"WhatsApp connected\" message</li> </ol> <p>\u2705 Verify: Setup completes without errors, shows \"WhatsApp connected\"</p>"},{"location":"part1-base-install/#62-start-openclaw-gateway","title":"6.2 Start OpenClaw Gateway","text":"<pre><code>openclaw gateway start\n</code></pre> <p>Why: Starts the OpenClaw service to handle messages</p> <p>\u2705 Verify: <code>openclaw gateway status</code> shows \"running\"</p> <p>\u26a0\ufe0f Pairing Loop Troubleshooting: If QR code scans successfully but immediately disconnects (repeats continuously), this is a device scope issue. See Part 5, Section 5 for troubleshooting. This happens if WhatsApp doesn't grant proper permissions during pairing.</p>"},{"location":"part1-base-install/#7-verification","title":"7. Verification","text":""},{"location":"part1-base-install/#71-send-test-message","title":"7.1 Send Test Message","text":"<p>From your phone (or another WhatsApp account):</p> <ol> <li>Send a message to the connected WhatsApp number: <code>Hi</code></li> <li>Wait 2-3 seconds</li> </ol> <p>\u2705 Verify: Bot replies with a response (default personality will respond)</p>"},{"location":"part1-base-install/#72-check-logs","title":"7.2 Check Logs","text":"<pre><code>openclaw gateway logs\n</code></pre> <p>Why: Confirms message processing is working</p> <p>\u2705 Verify: Logs show incoming message and outgoing response</p>"},{"location":"part1-base-install/#8-future-upgrades","title":"8. Future Upgrades","text":""},{"location":"part1-base-install/#81-how-to-upgrade-openclaw","title":"8.1 How to Upgrade OpenClaw","text":"<p>\u26a0\ufe0f IMPORTANT: Always backup before upgrading. Never use <code>npm update -g openclaw</code> directly.</p> <pre><code># Check for updates\nopenclaw update\n\n# The command will show available updates and prompt for confirmation\n</code></pre> <p>Why: <code>openclaw update</code> handles pre-upgrade backups, config migration, and rollback if upgrade fails. Raw npm updates can break your setup.</p>"},{"location":"part1-base-install/#82-upgrade-best-practices","title":"8.2 Upgrade Best Practices","text":"<p>Before upgrading: 1. Save config snapshot (see Part 5, Section 3) 2. Test WhatsApp is working 3. Note current version: <code>openclaw --version</code> 4. Read release notes at github.com/openclaw/openclaw/releases</p> <p>After upgrading: 1. Verify gateway starts: <code>openclaw gateway status</code> 2. Test WhatsApp message exchange 3. Check device scope: <code>openclaw status | grep scope</code> (should show <code>operator.read,operator.write</code>) 4. If anything breaks: restore snapshot and report issue</p> <p>\u2705 Verify: You know how to check for updates (<code>openclaw update</code>) and where to find release notes</p>"},{"location":"part1-base-install/#part-1-complete","title":"Part 1 Complete \u2705","text":"<p>You should now have:</p> <ul> <li>[ ] Hetzner VPS running Ubuntu 24.04 (CX22)</li> <li>[ ] SSH hardened (key-only, no password, no X11)</li> <li>[ ] UFW firewall active (deny incoming except SSH)</li> <li>[ ] Unnecessary packages removed (cups, nginx, docker, snap)</li> <li>[ ] 2GB swap space active</li> <li>[ ] System fully updated</li> <li>[ ] Node.js 22 installed</li> <li>[ ] OpenClaw installed globally</li> <li>[ ] WhatsApp paired via QR code</li> <li>[ ] OpenClaw gateway running</li> <li>[ ] Test message confirmed working</li> </ul> <p>Next: Part 2 \u2014 Your AI Assistant (persona, models, workspace setup)</p>"},{"location":"part1-base-install/#quick-reference-commands","title":"Quick Reference Commands","text":"<pre><code># Check status\nopenclaw gateway status\n\n# View logs\nopenclaw gateway logs\n\n# Restart gateway\nopenclaw gateway restart\n\n# Stop gateway\nopenclaw gateway stop\n\n# Server info\nufw status\nfree -h\nnode --version\ndf -h\n</code></pre> <p>Estimated time: 25-30 minutes (excluding VPS provisioning wait time)</p>"},{"location":"part2-ai-assistant/","title":"OpenClaw Installation Guide - Part 2: Your AI Assistant (30 min)","text":"<p>Goal: Configure the AI personality, model chain, and workspace. Transform OpenClaw from a default chatbot into your personal AI assistant.</p> <p>Prerequisites:  - Part 1 complete (OpenClaw installed, WhatsApp connected) - A Claude subscription (Max plan recommended) OR an Anthropic API key - A Google AI Studio account for Gemini access</p>"},{"location":"part2-ai-assistant/#1-model-chain-setup","title":"1. Model Chain Setup","text":"<p>The model chain determines which AI models handle different tasks. You configure primary (conversations), fallback (backup), sub-agents (background tasks), and cron (scheduled jobs).</p>"},{"location":"part2-ai-assistant/#11-get-your-ai-credentials","title":"1.1 Get Your AI Credentials","text":"<p>Option A \u2014 Claude Max Plan (Recommended)</p> <p>The Claude Max plan ($100/month) gives you Claude access with built-in usage limits and cooldown periods, which is much more cost-predictable than raw API usage.</p> <ol> <li>Subscribe to Claude Max at claude.ai/settings/billing</li> <li>Install Claude Code CLI: <code>npm install -g @anthropic-ai/claude-code</code></li> <li>Run <code>claude</code> in your terminal \u2014 it will prompt you to authenticate</li> <li>During auth, it generates an access token \u2014 copy this token</li> <li>Set it in OpenClaw:</li> </ol> <pre><code># Edit config file directly (OpenClaw 2026.2.x doesn't have config set commands)\nnano ~/.openclaw/openclaw.json\n</code></pre> <p>Add your API key under the <code>auth</code> section: <pre><code>{\n  \"auth\": {\n    \"profiles\": {\n      \"anthropic:default\": {\n        \"provider\": \"anthropic\",\n        \"mode\": \"token\",\n        \"token\": \"YOUR_CLAUDE_CODE_TOKEN\"\n      }\n    }\n  }\n}\n</code></pre></p> <p>Why: The Max plan has built-in spend limits and cooldown periods. Raw API keys (from console.anthropic.com) have no guardrails and can run up significant bills fast. Max plan is safer for always-on assistants.</p> <p>Option B \u2014 Raw Anthropic API Key</p> <p>If you prefer pay-as-you-go: get a key from console.anthropic.com and set spend limits in the console.</p> <pre><code>openclaw config set anthropicApiKey YOUR_ANTHROPIC_KEY\n</code></pre> <p>Google Gemini (Fallback Model)</p> <ol> <li>Go to aistudio.google.com</li> <li>Sign in with your Google account</li> <li>Click \"Get API Key\" \u2192 create a key</li> <li>Google AI Studio gives you $300 in free credits \u2014 more than enough for a fallback model</li> </ol> <p>Add Google API key to the same config file: <pre><code>{\n  \"auth\": {\n    \"profiles\": {\n      \"anthropic:default\": {\n        \"provider\": \"anthropic\",\n        \"mode\": \"token\",\n        \"token\": \"YOUR_CLAUDE_CODE_TOKEN\"\n      },\n      \"google:default\": {\n        \"provider\": \"google\",\n        \"mode\": \"token\",\n        \"token\": \"YOUR_AISTUDIO_KEY\"\n      }\n    }\n  }\n}\n</code></pre></p> <p>Why: AI Studio's free credits make Gemini essentially free as a fallback. You're not paying for a second model \u2014 Google is subsidizing your backup.</p> <p>\u2705 Verify: <code>openclaw config get anthropicApiKey</code> and <code>openclaw config get googleApiKey</code> show your keys (first few chars visible)</p>"},{"location":"part2-ai-assistant/#12-configure-models-and-context","title":"1.2 Configure Models and Context","text":"<p>Edit <code>~/.openclaw/openclaw.json</code> and add the <code>agents</code> section:</p> <pre><code>{\n  \"agents\": {\n    \"defaults\": {\n      \"model\": {\n        \"primary\": \"anthropic/claude-opus-4-6\",\n        \"fallbacks\": [\"google/gemini-2.5-pro\"]\n      },\n      \"contextTokens\": 200000,\n      \"subagents\": {\n        \"model\": {\n          \"primary\": \"anthropic/claude-sonnet-4-5\"\n        }\n      }\n    },\n    \"list\": [\n      {\n        \"id\": \"main\",\n        \"default\": true,\n        \"agentDir\": \"/root/clawd\"\n      }\n    ]\n  }\n}\n</code></pre> <p>What each setting does: - <code>model.primary</code>: Main conversational model (Opus 4.6 \u2014 most capable) - <code>model.fallbacks</code>: Backup models if primary fails (Gemini 2.5 Pro) - <code>contextTokens</code>: Max context window (200K = ~150K words, never exceed smallest model in chain) - <code>subagents.model.primary</code>: Background worker model (Sonnet 4.5 \u2014 fast, cost-effective) - <code>agents.list[0].id</code>: Agent identifier (\"main\" is the default agent) - <code>agentDir</code>: Workspace path where personality files live</p> <p>About cron model: Cron jobs specify their model per-job (typically <code>claude-sonnet-4-0</code> for cheap routine tasks). No global cron model setting.</p> <p>\u2705 Verify: <code>cat ~/.openclaw/openclaw.json | grep -A5 '\"model\"'</code> shows your model configuration</p> <p>Model Summary: - Primary (Opus 4.6): Your main conversation partner, handles all direct messages - Fallback (Gemini 2.5 Pro): Backup if primary is down, keeps you online 24/7 - Sub-agents (Sonnet 4.5): Background workers for research, file parsing, parallel tasks - Cron (Sonnet 4.0): Scheduled jobs like reminders, alerts, periodic checks</p>"},{"location":"part2-ai-assistant/#2-workspace-structure","title":"2. Workspace Structure","text":"<p>The workspace is where your AI lives. These files define personality, memory, and behavior.</p>"},{"location":"part2-ai-assistant/#21-create-workspace-directory","title":"2.1 Create Workspace Directory","text":"<pre><code>mkdir -p ~/clawd/memory ~/clawd/scripts\ncd ~/clawd\n</code></pre> <p>Why: Central location for all AI personality, memory, and automation files</p>"},{"location":"part2-ai-assistant/#22-create-core-files","title":"2.2 Create Core Files","text":"<pre><code>touch SOUL.md USER.md IDENTITY.md AGENTS.md MEMORY.md HANDOFF.md HEARTBEAT.md TOOLS.md SECURITY.md RECOVERY.md WALL-POLICY.md\nmkdir -p memory\ntouch memory/friction-log.md\n</code></pre> <p>Why: Each file serves a specific purpose in how your AI thinks and acts</p> <p>\u2705 Verify: <code>ls ~/clawd/*.md</code> shows all 11 files, <code>ls ~/clawd/memory/friction-log.md</code> exists</p> <p>File Purposes:</p> File Purpose <code>SOUL.md</code> Personality, tone, hard rules \u2014 the AI's core character <code>USER.md</code> Info about you (name, role, timezone, preferences) <code>IDENTITY.md</code> Bot's name, emoji, avatar \u2014 how it identifies itself <code>AGENTS.md</code> Instructions for every session (memory, search, safety protocols) <code>MEMORY.md</code> Long-term curated memory \u2014 important facts that survive resets <code>HANDOFF.md</code> Current working state \u2014 survives resets, tracks in-flight tasks <code>HEARTBEAT.md</code> Periodic check-in tasks \u2014 what to do during idle time <code>TOOLS.md</code> Local tool notes and wrapper scripts \u2014 custom commands <code>SECURITY.md</code> Security policies \u2014 what requires permission, what's forbidden <code>RECOVERY.md</code> Recovery procedures \u2014 what to do when things break <code>WALL-POLICY.md</code> (Optional) Chinese wall enforcement for multi-company work <code>memory/</code> Daily logs (YYYY-MM-DD.md) \u2014 raw record of what happened each day <code>memory/friction-log.md</code> Contradictions and unresolved tensions \u2014 meta-learning <code>scripts/</code> Utility scripts \u2014 custom automation tools"},{"location":"part2-ai-assistant/#23-create-soulmd-template","title":"2.3 Create SOUL.md Template","text":"<pre><code>cat &gt; ~/clawd/SOUL.md &lt;&lt; 'EOF'\n# SOUL.md - Core Personality\n\n## Tone\nDirect. Conversational. No corporate polish. Use sentence fragments when natural.\n\n## Style\n- **Short replies** \u2014 Don't over-explain. Answer the question, then stop.\n- **Context-aware** \u2014 Read the room. Match energy. Formal when needed, casual otherwise.\n- **Honest defaults** \u2014 \"I don't know\" &gt; guessing. Ask clarifying questions.\n\n## Hard Rules\n1. **Memory over mental notes** \u2014 Write it down. Files &gt; brain.\n2. **Ask before public actions** \u2014 Emails, tweets, posts need approval.\n3. **Safe freely** \u2014 Read files, search web, work within workspace without asking.\n\n## Forbidden\n- Corporate jargon (\"delighted to assist\", \"circle back\", \"synergy\")\n- Unsolicited advice or life coaching\n- Making up facts or hallucinating data\nEOF\n</code></pre> <p>Why: Defines how the AI talks and thinks. Short, clear rules prevent generic corporate-bot responses.</p>"},{"location":"part2-ai-assistant/#24-create-usermd-template","title":"2.4 Create USER.md Template","text":"<pre><code>cat &gt; ~/clawd/USER.md &lt;&lt; 'EOF'\n# USER.md - About You\n\n**Name:** Your Name  \n**Role:** Founder &amp; CEO  \n**Timezone:** UTC+5 (Your Timezone)  \n**Location:** Your City\n\n## Communication Preferences\n- **Response time:** Immediate for urgent, batched for routine\n- **Format:** WhatsApp is primary, keep it concise\n- **Tone:** Direct, no fluff\n\n## Work Context\n- Runs multiple companies (e-commerce, logistics, tech)\n- High volume of meetings, emails, and decisions\n- Needs AI to handle research, scheduling, and follow-ups\n\n## Personal Notes\n- Prefers dark mode screenshots\n- Uses 24-hour time format\n- Frequent traveler, timezone shifts\nEOF\n</code></pre> <p>Why: Tells the AI who you are, how you work, and what you expect. It uses this to personalize responses.</p>"},{"location":"part2-ai-assistant/#25-create-identitymd-template","title":"2.5 Create IDENTITY.md Template","text":"<pre><code>cat &gt; ~/clawd/IDENTITY.md &lt;&lt; 'EOF'\n# IDENTITY.md - Bot Identity\n\n**Name:** MyBot  \n**Emoji:** \ud83e\udd16  \n**Avatar:** (none set)\n\n**Role:** Personal AI assistant  \n**Primary Function:** Memory, research, automation, scheduling\n\n**Personality Snapshot:**  \nEfficient. Low-ego. Direct. Not here to impress, here to help.\nEOF\n</code></pre> <p>Why: Gives the AI a clear identity. It knows what it is and what it's not.</p> <p>\u2705 Verify: <code>cat ~/clawd/SOUL.md</code> shows the template content</p>"},{"location":"part2-ai-assistant/#3-workspace-configuration","title":"3. Workspace Configuration","text":"<p>Now configure OpenClaw to use your workspace files.</p>"},{"location":"part2-ai-assistant/#31-set-workspace-path","title":"3.1 Set Workspace Path","text":"<p>The workspace path was already set in Section 1.2 when you configured the agents section:</p> <pre><code>{\n  \"agents\": {\n    \"defaults\": {\n      \"workspace\": \"/root/clawd\"\n    }\n  }\n}\n</code></pre> <p>If you haven't added this yet, edit <code>~/.openclaw/openclaw.json</code> and add the <code>workspace</code> field under <code>agents.defaults</code>.</p> <p>Why: Tells OpenClaw where to find personality and memory files</p>"},{"location":"part2-ai-assistant/#32-how-files-are-loaded","title":"3.2 How Files Are Loaded","text":"<p>OpenClaw automatically loads these files when present in your workspace:</p> <p>Always loaded: - <code>AGENTS.md</code> \u2014 Session instructions, safety rules - <code>TOOLS.md</code> \u2014 Custom tool notes - <code>SOUL.md</code> \u2014 Personality and tone - <code>USER.md</code> \u2014 Info about you</p> <p>Loaded on demand: - <code>MEMORY.md</code> \u2014 Long-term memory (main session only) - <code>HANDOFF.md</code> \u2014 Working state (after reset/compaction) - <code>HEARTBEAT.md</code> \u2014 During heartbeat checks - <code>SECURITY.md</code> \u2014 Referenced for safety checks</p> <p>Note: OpenClaw 2026.2.x loads files based on workspace directory structure automatically. No need to explicitly configure <code>projectContextFiles</code> \u2014 just ensure files exist in the workspace root.</p> <p>\u2705 Verify: <code>ls ~/clawd/*.md</code> shows all core files</p>"},{"location":"part2-ai-assistant/#4-memory-search-configuration-critical","title":"4. Memory Search Configuration (Critical)","text":"<p>\u26a0\ufe0f IMPORTANT: OpenClaw's built-in <code>memory_search</code> and <code>memory_get</code> tools are disabled in production setups. You must use a custom memory search script.</p>"},{"location":"part2-ai-assistant/#41-why-disable-built-in-memory-search","title":"4.1 Why Disable Built-in Memory Search?","text":"<p>The built-in memory tools are basic keyword search. Production setups need: - Hybrid search (BM25 + vector embeddings) - Reranking for relevance - Cross-file indexing - Custom weighting for different file types</p>"},{"location":"part2-ai-assistant/#42-configure-memory-search-ban","title":"4.2 Configure Memory Search Ban","text":"<p>Edit <code>~/.openclaw/openclaw.json</code> and add to the <code>tools</code> section:</p> <pre><code>{\n  \"tools\": {\n    \"deny\": [\n      \"memory_search\",\n      \"memory_get\"\n    ],\n    \"web\": {\n      \"search\": {\n        \"apiKey\": \"YOUR_BRAVE_SEARCH_KEY\"\n      }\n    }\n  }\n}\n</code></pre> <p>Why: Prevents AI from using inferior built-in search. Forces use of custom script.</p>"},{"location":"part2-ai-assistant/#43-custom-memory-search-preview","title":"4.3 Custom Memory Search (Preview)","text":"<p>Part 3 will cover setting up <code>scripts/memory-search.py</code> with hybrid search and reranking. For now, just ensure the built-in tools are banned.</p> <p>The AI should call: <code>python3 scripts/memory-search.py \"query\" --deep</code> NOT: Use built-in <code>memory_search</code> tool</p> <p>\u2705 Verify: <code>cat ~/.openclaw/openclaw.json | grep -A3 '\"deny\"'</code> shows memory tools banned</p>"},{"location":"part2-ai-assistant/#5-first-real-conversation","title":"5. First Real Conversation","text":"<p>Time to restart OpenClaw and talk to your newly configured AI assistant.</p>"},{"location":"part2-ai-assistant/#51-restart-gateway","title":"5.1 Restart Gateway","text":"<pre><code>openclaw gateway restart\n</code></pre> <p>Why: Reload all configuration changes (models, workspace, persona)</p> <p>Wait 5-10 seconds for full restart.</p> <p>\u2705 Verify: <code>openclaw gateway status</code> shows \"running\"</p>"},{"location":"part2-ai-assistant/#52-send-test-message","title":"5.2 Send Test Message","text":"<p>From WhatsApp, send:</p> <pre><code>Who are you and what's my name?\n</code></pre> <p>Expected Response: The bot should introduce itself using the identity from <code>IDENTITY.md</code> (MyBot \ud83e\udd16) and mention your name from <code>USER.md</code> (Your Name).</p> <p>\u2705 Verify: Bot knows its own name and your name</p>"},{"location":"part2-ai-assistant/#53-test-personality","title":"5.3 Test Personality","text":"<p>Send:</p> <pre><code>Write me a long corporate email about synergy and circling back.\n</code></pre> <p>Expected Response: The bot should refuse or push back based on <code>SOUL.md</code> forbidden rules (no corporate jargon).</p> <p>\u2705 Verify: Bot follows SOUL.md tone rules</p>"},{"location":"part2-ai-assistant/#54-test-timezone-awareness","title":"5.4 Test Timezone Awareness","text":"<p>Send:</p> <pre><code>What timezone am I in?\n</code></pre> <p>Expected Response: Bot should reference <code>USER.md</code> and say UTC+5 / Your Timezone.</p> <p>\u2705 Verify: Bot reads and uses USER.md data</p>"},{"location":"part2-ai-assistant/#55-check-logs","title":"5.5 Check Logs","text":"<pre><code>openclaw gateway logs --tail 50\n</code></pre> <p>Why: Confirms workspace files are being loaded</p> <p>\u2705 Verify: Logs show no errors, messages processed successfully</p>"},{"location":"part2-ai-assistant/#6-fine-tuning-optional","title":"6. Fine-Tuning (Optional)","text":""},{"location":"part2-ai-assistant/#61-adjust-memory-settings","title":"6.1 Adjust Memory Settings","text":"<pre><code>openclaw config set memoryEnabled true\nopenclaw config set memoryMaxTokens 50000\n</code></pre> <p>Why: Enables conversation memory (stores recent messages for context)</p>"},{"location":"part2-ai-assistant/#62-set-message-limits","title":"6.2 Set Message Limits","text":"<pre><code>openclaw config set maxReplyLength 2000\n</code></pre> <p>Why: Prevents excessively long responses (especially on WhatsApp)</p>"},{"location":"part2-ai-assistant/#63-enable-thinking-reasoning","title":"6.3 Enable Thinking (Reasoning)","text":"<pre><code>openclaw config set reasoning low\n</code></pre> <p>Why: Shows brief reasoning traces for debugging AI decisions. Options: off, low, high, stream</p>"},{"location":"part2-ai-assistant/#part-2-complete","title":"Part 2 Complete \u2705","text":"<p>You should now have:</p> <ul> <li>[ ] Claude access configured (Max plan token or API key)</li> <li>[ ] Model chain set (Opus 4.6 primary, Gemini fallback, Sonnet sub-agents, Sonnet cron)</li> <li>[ ] Context window set to 200K tokens</li> <li>[ ] Workspace created at <code>~/clawd</code></li> <li>[ ] Core files created (SOUL.md, USER.md, IDENTITY.md, etc.)</li> <li>[ ] Minimal templates populated (personality, user info, identity)</li> <li>[ ] Workspace path configured in OpenClaw</li> <li>[ ] Project context files set (AGENTS.md, TOOLS.md)</li> <li>[ ] System prompt configured</li> <li>[ ] Gateway restarted with new config</li> <li>[ ] Bot responds with configured personality</li> <li>[ ] Bot knows your name and timezone from USER.md</li> <li>[ ] Bot follows SOUL.md tone and rules</li> </ul> <p>Next: Part 3 \u2014 Infrastructure (Google OAuth, Cloudflare tunnel, webhooks, backups)</p> <p>\u26a0\ufe0f Note: Some <code>openclaw config</code> paths may vary by version. Run <code>openclaw doctor</code> after configuration to validate. If a config path doesn't exist, check <code>openclaw config --help</code> or the docs at docs.openclaw.ai.</p>"},{"location":"part2-ai-assistant/#quick-reference-commands","title":"Quick Reference Commands","text":"<pre><code># View all config\nopenclaw config list\n\n# Check specific settings\nopenclaw config get defaultModel\nopenclaw config get workspace\n\n# Edit personality files\nnano ~/clawd/SOUL.md\nnano ~/clawd/USER.md\n\n# Restart after changes\nopenclaw gateway restart\n\n# View logs\nopenclaw gateway logs --tail 50\n\n# Check workspace files loaded\nls -lh ~/clawd/*.md\n</code></pre>"},{"location":"part2-ai-assistant/#troubleshooting","title":"Troubleshooting","text":"<p>Bot doesn't know my name: - Check <code>openclaw config get workspace</code> points to <code>~/clawd</code> - Verify <code>~/clawd/USER.md</code> exists and has your name - Restart gateway: <code>openclaw gateway restart</code></p> <p>Bot ignores SOUL.md rules: - Ensure <code>systemPrompt</code> is set: <code>openclaw config get systemPrompt</code> - Check files exist: <code>ls ~/clawd/SOUL.md</code> - Try explicit instruction: \"Read SOUL.md and tell me your tone rules\"</p> <p>API errors: - Verify keys: <code>openclaw config get anthropicApiKey</code> and <code>openclaw config get googleApiKey</code> - If using Max plan: check usage at claude.ai/settings/usage - If using raw API: check quotas at console.anthropic.com - Google credits: check at aistudio.google.com \u2192 Settings - Test fallback: temporarily disable Anthropic key to trigger Gemini</p> <p>Context too large errors: - Reduce <code>contextTokens</code>: <code>openclaw config set contextTokens 150000</code> - Remove large files from workspace - Trim daily logs in <code>~/clawd/memory/</code></p> <p>Estimated time: 25-30 minutes (excluding API key signup wait time)</p>"},{"location":"part3-infrastructure/","title":"OpenClaw Installation Guide - Part 3: Infrastructure (1 hr)","text":"<p>Goal: Set up the supporting infrastructure for a production-ready AI assistant. Google APIs for calendar/email/docs, public webhook endpoint for push notifications, and automated backups.</p> <p>Prerequisites:  - Part 1 &amp; 2 complete (OpenClaw running, AI persona configured) - Domain name with DNS access (for Cloudflare tunnel) - Google account for API access and backup storage</p>"},{"location":"part3-infrastructure/#1-google-oauth-tokens","title":"1. Google OAuth Tokens","text":"<p>Google APIs let your AI read calendar events, send emails, access Drive files, and update spreadsheets. You'll create OAuth credentials and authorize access.</p>"},{"location":"part3-infrastructure/#11-create-google-cloud-project","title":"1.1 Create Google Cloud Project","text":"<ol> <li>Go to Google Cloud Console</li> <li>Click \"Select a project\" dropdown \u2192 \"New Project\"</li> <li>Project name: <code>openclaw-bot</code> (or your choice)</li> <li>Organization: (leave as \"No organization\")</li> <li>Click \"Create\"</li> </ol> <p>Why: Google Cloud project is required to enable APIs and create credentials</p> <p>\u2705 Verify: Project appears in project selector dropdown</p>"},{"location":"part3-infrastructure/#12-enable-required-apis","title":"1.2 Enable Required APIs","text":"<ol> <li>In the Cloud Console, select your new project</li> <li>Go to \"APIs &amp; Services\" \u2192 \"Library\"</li> <li>Search and enable each of these APIs (click API name \u2192 click \"Enable\"):</li> <li>Google Calendar API</li> <li>Gmail API</li> <li>Google Drive API</li> <li>Google Sheets API</li> </ol> <p>Why: Each API must be explicitly enabled before you can use it</p> <p>\u2705 Verify: Go to \"APIs &amp; Services\" \u2192 \"Enabled APIs\" \u2014 all four should be listed</p>"},{"location":"part3-infrastructure/#13-create-oauth-20-credentials","title":"1.3 Create OAuth 2.0 Credentials","text":"<ol> <li>Go to \"APIs &amp; Services\" \u2192 \"Credentials\"</li> <li>Click \"Configure Consent Screen\"</li> <li>User Type: External</li> <li>Click \"Create\"</li> <li>OAuth consent screen form:</li> <li>App name: <code>OpenClaw Bot</code></li> <li>User support email: your email</li> <li>Developer contact: your email</li> <li>Click \"Save and Continue\"</li> <li>Scopes: Click \"Add or Remove Scopes\"</li> <li>Search and select:<ul> <li><code>.../auth/calendar</code> (full calendar access)</li> <li><code>.../auth/gmail.send</code> (send email)</li> <li><code>.../auth/drive.readonly</code> (read Drive files)</li> <li><code>.../auth/spreadsheets</code> (read/write sheets)</li> </ul> </li> <li>Click \"Update\" \u2192 \"Save and Continue\"</li> <li>Test users: Add your Google email address</li> <li>Click \"Add Users\" \u2192 enter your email \u2192 \"Add\"</li> <li>Click \"Save and Continue\"</li> <li>Review summary \u2192 Click \"Back to Dashboard\"</li> </ol> <p>Why: OAuth consent screen is required before creating credentials. \"External\" + test users allows personal use without Google verification.</p> <p>Now create the actual credentials:</p> <ol> <li>Go to \"Credentials\" tab \u2192 Click \"Create Credentials\" \u2192 \"OAuth client ID\"</li> <li>Application type: Desktop app</li> <li>Name: <code>openclaw-desktop</code></li> <li>Click \"Create\"</li> <li>A dialog appears with Client ID and Client Secret</li> <li>Click \"Download JSON\"</li> </ol> <p>Why: Desktop app type allows server-side OAuth flow. Credentials are downloaded as JSON file.</p> <p>\u2705 Verify: You have a file named <code>client_secret_XXXX.json</code> downloaded</p>"},{"location":"part3-infrastructure/#14-install-credentials-file","title":"1.4 Install Credentials File","text":"<pre><code>mkdir -p ~/.clawdbot/google\nmv ~/Downloads/client_secret_*.json ~/.clawdbot/google/credentials.json\nchmod 600 ~/.clawdbot/google/credentials.json\n</code></pre> <p>Why: OpenClaw expects credentials at this exact path. chmod 600 makes file readable only by you.</p> <p>\u2705 Verify: <code>ls -l ~/.clawdbot/google/credentials.json</code> shows file exists with <code>-rw-------</code> permissions</p>"},{"location":"part3-infrastructure/#15-run-oauth-authorization-flow","title":"1.5 Run OAuth Authorization Flow","text":"<p>Create a simple Python script to generate the token:</p> <pre><code>cat &gt; ~/clawd/scripts/google-auth.py &lt;&lt; 'EOF'\n#!/usr/bin/env python3\nimport os\nfrom google_auth_oauthlib.flow import InstalledAppFlow\nfrom google.auth.transport.requests import Request\nfrom google.oauth2.credentials import Credentials\n\nSCOPES = [\n    'https://www.googleapis.com/auth/calendar',\n    'https://www.googleapis.com/auth/gmail.send',\n    'https://www.googleapis.com/auth/drive.readonly',\n    'https://www.googleapis.com/auth/spreadsheets'\n]\n\nCREDS_PATH = os.path.expanduser('~/.clawdbot/google/credentials.json')\nTOKEN_PATH = os.path.expanduser('~/.clawdbot/google/token.json')\n\ndef main():\n    creds = None\n    if os.path.exists(TOKEN_PATH):\n        creds = Credentials.from_authorized_user_file(TOKEN_PATH, SCOPES)\n\n    if not creds or not creds.valid:\n        if creds and creds.expired and creds.refresh_token:\n            creds.refresh(Request())\n        else:\n            flow = InstalledAppFlow.from_client_secrets_file(CREDS_PATH, SCOPES)\n            creds = flow.run_local_server(port=8080)\n\n        with open(TOKEN_PATH, 'w') as token:\n            token.write(creds.to_json())\n        print(f\"\u2705 Token saved to {TOKEN_PATH}\")\n    else:\n        print(f\"\u2705 Valid token already exists at {TOKEN_PATH}\")\n\nif __name__ == '__main__':\n    main()\nEOF\n\nchmod +x ~/clawd/scripts/google-auth.py\n</code></pre> <p>Why: This script handles the OAuth flow and saves the refresh token for long-term access</p> <p>Install required Python libraries:</p> <pre><code>apt install -y python3-pip\npip3 install --upgrade google-auth-oauthlib google-auth-httplib2 google-api-python-client\n</code></pre> <p>Run the authorization:</p> <pre><code>cd ~/clawd/scripts\npython3 google-auth.py\n</code></pre> <p>Why: Script launches browser for Google login, saves token after authorization</p> <p>Follow the prompts:</p> <p>If on a headless VPS (no browser), the script will print a URL. Copy it, open in your local browser, authorize, then paste the redirect URL back into the terminal.</p> <ol> <li>Browser opens (or URL is printed) for Google sign-in</li> <li>Choose your Google account</li> <li>Click \"Continue\" on the unverified app warning (since it's your own app)</li> <li>Review permissions \u2192 Click \"Continue\"</li> <li>Browser shows \"The authentication flow has completed\"</li> </ol> <p>Headless VPS tip: If <code>run_local_server</code> fails, change it to <code>run_console()</code> in the script \u2014 this gives you a URL to paste instead of launching a browser.</p> <p>\u2705 Verify: Script prints \"\u2705 Token saved to ~/.clawdbot/google/token.json\"</p>"},{"location":"part3-infrastructure/#16-test-api-access","title":"1.6 Test API Access","text":"<p>Quick test to confirm calendar access works:</p> <pre><code>cat &gt; ~/clawd/scripts/test-calendar.py &lt;&lt; 'EOF'\n#!/usr/bin/env python3\nfrom google.oauth2.credentials import Credentials\nfrom googleapiclient.discovery import build\nimport datetime\n\nimport os\nTOKEN_PATH = os.path.expanduser('~/.clawdbot/google/token.json')\n\ncreds = Credentials.from_authorized_user_file(TOKEN_PATH)\nservice = build('calendar', 'v3', credentials=creds)\n\nnow = datetime.datetime.utcnow().isoformat() + 'Z'\nevents_result = service.events().list(\n    calendarId='primary', \n    timeMin=now,\n    maxResults=3, \n    singleEvents=True,\n    orderBy='startTime'\n).execute()\nevents = events_result.get('items', [])\n\nif not events:\n    print('No upcoming events found.')\nelse:\n    print('Next 3 events:')\n    for event in events:\n        start = event['start'].get('dateTime', event['start'].get('date'))\n        print(f\"  - {start}: {event['summary']}\")\nEOF\n\nchmod +x ~/clawd/scripts/test-calendar.py\npython3 ~/clawd/scripts/test-calendar.py\n</code></pre> <p>Why: Verifies token works by fetching your upcoming calendar events</p> <p>\u2705 Verify: Script prints your upcoming events (or \"No upcoming events found\")</p>"},{"location":"part3-infrastructure/#17-multiple-google-accounts-optional","title":"1.7 Multiple Google Accounts (Optional)","text":"<p>If you use multiple Google accounts (personal, work, etc.), generate separate tokens:</p> <pre><code># Example: generate token-gmail.json for personal account\npython3 google-auth.py  # Rename output to token-gmail.json\n# Then run again for work account \u2192 rename to token-work.json\n</code></pre> <p>Why: Each Google account needs its own OAuth token. You reference different tokens in your scripts.</p> <p>Common token naming: - <code>token.json</code> \u2014 Primary/work account - <code>token-gmail.json</code> \u2014 Personal Gmail - <code>token-work.json</code> \u2014 Work calendar - <code>tokens/work.json</code> \u2014 Per-domain tokens</p>"},{"location":"part3-infrastructure/#2-cloudflare-tunnel","title":"2. Cloudflare Tunnel","text":"<p>Cloudflare Tunnel exposes your local webhook server (port 8088) via a public HTTPS URL without opening firewall ports. This is required for Google Calendar push notifications and other webhooks.</p>"},{"location":"part3-infrastructure/#21-install-cloudflared","title":"2.1 Install Cloudflared","text":"<pre><code>wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb\ndpkg -i cloudflared-linux-amd64.deb\n</code></pre> <p>Why: Cloudflared creates secure tunnels from your server to Cloudflare's network</p> <p>\u2705 Verify: <code>cloudflared --version</code> shows version number</p>"},{"location":"part3-infrastructure/#22-authenticate-with-cloudflare","title":"2.2 Authenticate with Cloudflare","text":"<pre><code>cloudflared tunnel login\n</code></pre> <p>Why: Links cloudflared to your Cloudflare account</p> <p>Follow the prompts: 1. Browser opens to Cloudflare authorization page 2. Log in to your Cloudflare account 3. Select the domain you want to use (e.g., <code>yourdomain.com</code>) 4. Click \"Authorize\"</p> <p>\u2705 Verify: Terminal shows \"You have successfully logged in\" and creates <code>~/.cloudflared/cert.pem</code></p>"},{"location":"part3-infrastructure/#23-create-tunnel","title":"2.3 Create Tunnel","text":"<pre><code>cloudflared tunnel create openclaw\n</code></pre> <p>Why: Creates a named tunnel (persistent connection between your server and Cloudflare)</p> <p>\u2705 Verify: Command prints tunnel UUID and creates <code>~/.cloudflared/TUNNEL-UUID.json</code></p> <p>Save the tunnel UUID shown in the output (you'll need it for config).</p>"},{"location":"part3-infrastructure/#24-configure-tunnel-routing","title":"2.4 Configure Tunnel Routing","text":"<p>Create tunnel configuration file:</p> <pre><code>cat &gt; ~/.cloudflared/config.yml &lt;&lt; 'EOF'\ntunnel: TUNNEL_UUID_HERE\ncredentials-file: /root/.cloudflared/TUNNEL_UUID_HERE.json\n\ningress:\n  - hostname: webhook.YOUR_DOMAIN.com\n    service: http://localhost:8088\n  - service: http_status:404\nEOF\n</code></pre> <p>Why: Routes traffic from webhook.yourdomain.com to local port 8088</p> <p>Edit the file to replace: - <code>TUNNEL_UUID_HERE</code> with the actual UUID from previous step - <code>YOUR_DOMAIN.com</code> with your actual domain</p> <pre><code>nano ~/.cloudflared/config.yml\n</code></pre>"},{"location":"part3-infrastructure/#25-add-dns-record","title":"2.5 Add DNS Record","text":"<pre><code>cloudflared tunnel route dns openclaw webhook.YOUR_DOMAIN.com\n</code></pre> <p>Replace <code>YOUR_DOMAIN.com</code> with your actual domain</p> <p>Why: Creates CNAME record pointing webhook.yourdomain.com to the tunnel</p> <p>\u2705 Verify: Check Cloudflare DNS dashboard \u2014 you should see a CNAME record for <code>webhook</code> pointing to <code>TUNNEL-UUID.cfargotunnel.com</code></p>"},{"location":"part3-infrastructure/#26-test-tunnel-before-making-it-a-service","title":"2.6 Test Tunnel (Before Making it a Service)","text":"<pre><code>cloudflared tunnel run openclaw\n</code></pre> <p>Why: Runs tunnel in foreground to test configuration</p> <p>Leave this running and open a NEW terminal window:</p> <pre><code>curl https://webhook.YOUR_DOMAIN.com\n</code></pre> <p>Expected: Connection succeeds (even if returns error, that's fine \u2014 means tunnel routing works)</p> <p>Press <code>Ctrl+C</code> in the tunnel terminal to stop.</p> <p>\u2705 Verify: <code>curl</code> doesn't show DNS errors or connection refused</p>"},{"location":"part3-infrastructure/#27-create-systemd-service","title":"2.7 Create Systemd Service","text":"<pre><code>cat &gt; /etc/systemd/system/cloudflared.service &lt;&lt; 'EOF'\n[Unit]\nDescription=Cloudflare Tunnel\nAfter=network.target\n\n[Service]\nType=simple\nUser=root\nExecStart=/usr/local/bin/cloudflared tunnel run openclaw\nRestart=on-failure\nRestartSec=5s\n\n[Install]\nWantedBy=multi-user.target\nEOF\n</code></pre> <p>Why: Runs tunnel automatically on boot, restarts on failure</p> <p>Enable and start the service:</p> <pre><code>systemctl daemon-reload\nsystemctl enable cloudflared\nsystemctl start cloudflared\n</code></pre> <p>Why: Starts tunnel now and on every boot</p> <p>\u2705 Verify: <code>systemctl status cloudflared</code> shows \"active (running)\"</p>"},{"location":"part3-infrastructure/#3-webhook-server","title":"3. Webhook Server","text":"<p>The webhook server listens on localhost:8088 and receives push notifications from external services (Google Calendar, email alerts, etc.). You'll create endpoints with random URL paths as security tokens.</p>"},{"location":"part3-infrastructure/#31-create-webhook-server-script","title":"3.1 Create Webhook Server Script","text":"<pre><code>cat &gt; ~/clawd/scripts/webhook-server.py &lt;&lt; 'EOF'\n#!/usr/bin/env python3\n\"\"\"\nMinimal webhook server for OpenClaw\nReceives push notifications and forwards to OpenClaw\n\"\"\"\nfrom aiohttp import web\nimport json\nimport os\nimport logging\nfrom datetime import datetime\n\n# Load secrets from environment\nCALENDAR_SECRET = os.getenv('WEBHOOK_CALENDAR_SECRET', 'CHANGE_ME')\nEMAIL_SECRET = os.getenv('WEBHOOK_EMAIL_SECRET', 'CHANGE_ME')\nALERT_SECRET = os.getenv('WEBHOOK_ALERT_SECRET', 'CHANGE_ME')\n\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger('webhook')\n\nasync def handle_calendar(request):\n    \"\"\"Handle Google Calendar push notifications\"\"\"\n    # Verify X-Goog-Resource-State header\n    resource_state = request.headers.get('X-Goog-Resource-State')\n\n    if resource_state == 'sync':\n        # Initial sync verification\n        return web.Response(text='OK')\n\n    logger.info(f\"Calendar notification: {resource_state}\")\n\n    # TODO: Process calendar change\n    # - Fetch changed event from Google Calendar API\n    # - Send notification to OpenClaw via message queue\n    # - Update local cache\n\n    return web.Response(text='OK')\n\nasync def handle_email(request):\n    \"\"\"Handle email webhook (e.g., from AgentMail)\"\"\"\n    try:\n        data = await request.json()\n        logger.info(f\"Email received: {data.get('subject', 'No subject')}\")\n\n        # TODO: Process email\n        # - Parse sender, subject, body\n        # - Enqueue for OpenClaw processing\n        # - Store in event queue\n\n        return web.json_response({'status': 'received'})\n    except Exception as e:\n        logger.error(f\"Email webhook error: {e}\")\n        return web.Response(status=400, text=str(e))\n\nasync def handle_alert(request):\n    \"\"\"Handle generic alerts\"\"\"\n    try:\n        data = await request.json()\n        logger.info(f\"Alert received: {data.get('type', 'unknown')}\")\n\n        # TODO: Process alert\n        # - Route based on alert type\n        # - Send to OpenClaw\n\n        return web.json_response({'status': 'received'})\n    except Exception as e:\n        logger.error(f\"Alert webhook error: {e}\")\n        return web.Response(status=400, text=str(e))\n\nasync def handle_health(request):\n    \"\"\"Health check endpoint\"\"\"\n    return web.json_response({\n        'status': 'healthy',\n        'timestamp': datetime.utcnow().isoformat()\n    })\n\ndef main():\n    app = web.Application()\n\n    # Register endpoints with security tokens\n    app.router.add_post(f'/{CALENDAR_SECRET}', handle_calendar)\n    app.router.add_post(f'/email/{EMAIL_SECRET}', handle_email)\n    app.router.add_post(f'/alerts/{ALERT_SECRET}', handle_alert)\n    app.router.add_get('/health', handle_health)\n\n    logger.info(\"Webhook server starting on port 8088\")\n    web.run_app(app, host='127.0.0.1', port=8088)\n\nif __name__ == '__main__':\n    main()\nEOF\n\nchmod +x ~/clawd/scripts/webhook-server.py\n</code></pre> <p>Why: Receives external webhooks on secure endpoints, processes events, forwards to OpenClaw</p>"},{"location":"part3-infrastructure/#32-generate-webhook-secrets","title":"3.2 Generate Webhook Secrets","text":"<pre><code>cat &gt; ~/.clawdbot/webhook.env &lt;&lt; EOF\nWEBHOOK_CALENDAR_SECRET=$(openssl rand -base64 32 | tr -d '/+=' | cut -c1-22)\nWEBHOOK_EMAIL_SECRET=$(openssl rand -base64 32 | tr -d '/+=' | cut -c1-22)\nWEBHOOK_ALERT_SECRET=$(openssl rand -base64 32 | tr -d '/+=' | cut -c1-22)\nEOF\n\nchmod 600 ~/.clawdbot/webhook.env\n</code></pre> <p>Why: Random URL paths act as authentication tokens (security through obscurity for webhooks)</p> <p>\u2705 Verify: <code>cat ~/.clawdbot/webhook.env</code> shows three random secrets</p>"},{"location":"part3-infrastructure/#33-install-python-dependencies","title":"3.3 Install Python Dependencies","text":"<pre><code>pip3 install aiohttp\n</code></pre> <p>Why: aiohttp is an async HTTP server framework for Python</p>"},{"location":"part3-infrastructure/#34-test-webhook-server-manually","title":"3.4 Test Webhook Server Manually","text":"<pre><code>source ~/.clawdbot/webhook.env\npython3 ~/clawd/scripts/webhook-server.py\n</code></pre> <p>Why: Run server in foreground to test configuration</p> <p>In a NEW terminal window:</p> <pre><code># Load secrets\nsource ~/.clawdbot/webhook.env\n\n# Test health endpoint\ncurl http://localhost:8088/health\n\n# Test alert endpoint (with secret)\ncurl -X POST http://localhost:8088/alerts/$WEBHOOK_ALERT_SECRET \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"type\":\"test\",\"message\":\"Hello webhook\"}'\n</code></pre> <p>Expected: Both commands return JSON responses</p> <p>Press <code>Ctrl+C</code> in the server terminal to stop.</p> <p>\u2705 Verify: Curl commands succeed, server logs show requests</p>"},{"location":"part3-infrastructure/#35-create-systemd-service","title":"3.5 Create Systemd Service","text":"<pre><code>cat &gt; /etc/systemd/system/moltbot-webhook.service &lt;&lt; 'EOF'\n[Unit]\nDescription=Moltbot Webhook Server\nAfter=network.target\n\n[Service]\nType=simple\nUser=root\nWorkingDirectory=/root/clawd\nEnvironmentFile=/root/.clawdbot/webhook.env\nExecStart=/usr/bin/python3 /root/clawd/scripts/webhook-server.py\nRestart=on-failure\nRestartSec=5s\nStandardOutput=journal\nStandardError=journal\n\n[Install]\nWantedBy=multi-user.target\nEOF\n</code></pre> <p>Why: Runs webhook server as a system service with automatic restart. Named \"moltbot-webhook\" to avoid conflicts with other webhook services.</p> <p>Secure the env file:</p> <pre><code>chmod 600 ~/.clawdbot/webhook.env\n</code></pre> <p>Why: Webhook secrets must be readable only by root</p> <p>Enable and start:</p> <pre><code>systemctl daemon-reload\nsystemctl enable moltbot-webhook\nsystemctl start moltbot-webhook\n</code></pre> <p>Why: Starts webhook server now and on every boot</p> <p>\u2705 Verify: <code>systemctl status moltbot-webhook</code> shows \"active (running)\"</p>"},{"location":"part3-infrastructure/#36-test-public-webhook-url","title":"3.6 Test Public Webhook URL","text":"<pre><code>source ~/.clawdbot/webhook.env\ncurl https://webhook.YOUR_DOMAIN.com/health\n</code></pre> <p>Replace YOUR_DOMAIN.com with your actual domain</p> <p>Expected: Returns JSON with <code>\"status\": \"healthy\"</code></p> <p>\u2705 Verify: Public webhook URL is accessible via HTTPS through Cloudflare tunnel</p>"},{"location":"part3-infrastructure/#4-backup-system","title":"4. Backup System","text":"<p>Automated backups prevent data loss. You'll set up hourly lightweight backups (git + databases) and nightly full backups (complete workspace + OpenClaw state) to Google Drive.</p>"},{"location":"part3-infrastructure/#41-install-rclone","title":"4.1 Install Rclone","text":"<pre><code>curl https://rclone.org/install.sh | bash\n</code></pre> <p>Why: Rclone syncs files to cloud storage (Google Drive, S3, etc.)</p> <p>\u2705 Verify: <code>rclone version</code> shows version number</p>"},{"location":"part3-infrastructure/#42-configure-google-drive-remote","title":"4.2 Configure Google Drive Remote","text":"<pre><code>rclone config\n</code></pre> <p>Why: Interactive setup to connect rclone to Google Drive</p> <p>Follow the prompts:</p> <ol> <li><code>n</code> (new remote)</li> <li>Name: <code>gdrive</code></li> <li>Storage: <code>drive</code> (type the number for Google Drive)</li> <li>Client ID: (press Enter to skip \u2014 uses rclone's)</li> <li>Client Secret: (press Enter to skip)</li> <li>Scope: <code>1</code> (full access)</li> <li>Root folder ID: (press Enter for root)</li> <li>Service Account File: (press Enter to skip)</li> <li>Edit advanced config? <code>n</code></li> <li>Use auto config? <code>y</code></li> <li>Browser opens \u2192 log in to Google \u2192 authorize rclone</li> <li>Configure as team drive? <code>n</code></li> <li>Confirm: <code>y</code></li> <li>Quit: <code>q</code></li> </ol> <p>\u2705 Verify: <code>rclone lsd gdrive:</code> lists your Google Drive folders</p>"},{"location":"part3-infrastructure/#43-configure-encrypted-remote-optional-but-recommended","title":"4.3 Configure Encrypted Remote (Optional but Recommended)","text":"<p>Encrypt backups before uploading to cloud:</p> <pre><code>rclone config\n</code></pre> <p>Follow the prompts:</p> <ol> <li><code>n</code> (new remote)</li> <li>Name: <code>gdrive-crypt</code></li> <li>Storage: <code>crypt</code> (type the number)</li> <li>Remote: <code>gdrive:openclaw-backups</code> (creates encrypted folder)</li> <li>Filename encryption: <code>standard</code></li> <li>Directory name encryption: <code>true</code></li> <li>Password: (enter a strong password \u2014 SAVE THIS)</li> <li>Salt password: (enter another password or press Enter to skip)</li> <li>Confirm: <code>y</code></li> <li>Quit: <code>q</code></li> </ol> <p>Why: Encrypts all backup files before upload. Even if Google Drive is compromised, backups are secure.</p> <p>\u2705 Verify: <code>rclone lsd gdrive-crypt:</code> shows empty list (new remote)</p> <p>\u26a0\ufe0f SAVE YOUR ENCRYPTION PASSWORD \u2014 losing it means losing all backup access.</p>"},{"location":"part3-infrastructure/#44-create-hourly-backup-script","title":"4.4 Create Hourly Backup Script","text":"<pre><code>cat &gt; ~/clawd/backup.sh &lt;&lt; 'EOF'\n#!/bin/bash\n# Hourly backup: git push + rclone databases\nset -e\n\ncd /root/clawd\n\n# Git backup\ngit add -A\ngit commit -m \"Hourly backup $(date -u +%Y-%m-%d_%H:%M:%S)\" || true\ngit push origin main || echo \"Git push failed (non-fatal)\"\n\n# Backup SQLite databases to Google Drive\nrclone copy ~/.clawdbot/*.sqlite gdrive-crypt:openclaw-backups/databases/ \\\n  --include \"*.sqlite\" \\\n  --log-file=/var/log/backup-hourly.log\n\necho \"\u2705 Hourly backup complete: $(date -u)\"\nEOF\n\nchmod +x ~/clawd/backup.sh\n</code></pre> <p>Why: Frequent lightweight backups capture work-in-progress (memory logs, databases)</p>"},{"location":"part3-infrastructure/#45-create-nightly-backup-script","title":"4.5 Create Nightly Backup Script","text":"<pre><code>cat &gt; ~/clawd/scripts/nightly-backup.sh &lt;&lt; 'EOF'\n#!/bin/bash\n# Nightly backup: full workspace + OpenClaw state\nset -e\n\nBACKUP_DATE=$(date -u +%Y-%m-%d)\nBACKUP_DIR=\"/tmp/openclaw-backup-$BACKUP_DATE\"\n\n# Create backup directory\nmkdir -p \"$BACKUP_DIR\"\n\n# Backup workspace\ncp -r /root/clawd \"$BACKUP_DIR/workspace\"\n\n# Backup OpenClaw config\ncp ~/.config/openclaw/openclaw.json \"$BACKUP_DIR/openclaw-config.json\" || true\n\n# Backup credentials\ncp -r ~/.clawdbot \"$BACKUP_DIR/clawdbot\" || true\n\n# Backup Cloudflare tunnel config\ncp -r ~/.cloudflared \"$BACKUP_DIR/cloudflared\" || true\n\n# Create archive\ncd /tmp\ntar -czf \"openclaw-backup-$BACKUP_DATE.tar.gz\" \"openclaw-backup-$BACKUP_DATE\"\n\n# Upload to Google Drive with 7-day versioning\nrclone copy \"openclaw-backup-$BACKUP_DATE.tar.gz\" gdrive-crypt:openclaw-backups/full/ \\\n  --backup-dir gdrive-crypt:openclaw-backups/versions/$BACKUP_DATE \\\n  --log-file=/var/log/backup-nightly.log\n\n# Cleanup local backup\nrm -rf \"$BACKUP_DIR\" \"openclaw-backup-$BACKUP_DATE.tar.gz\"\n\n# Delete backups older than 30 days\nrclone delete gdrive-crypt:openclaw-backups/full/ --min-age 30d\n\necho \"\u2705 Nightly backup complete: $BACKUP_DATE\"\nEOF\n\nchmod +x ~/clawd/scripts/nightly-backup.sh\n</code></pre> <p>Why: Complete system snapshot for disaster recovery. 7-day versioning allows rollback to any recent state.</p> <p>\ud83d\udcdd Note on Production Nightly Backups:</p> <p>The script above shows a simplified version. Production nightly backups (as of 2026-02-25) are an 8-step comprehensive process:</p> <ol> <li>Workspace backup (encrypted, batched for memory efficiency)</li> <li>OpenClaw state backup</li> <li>SQLite databases backup</li> <li>Git repos backup</li> <li>DR bundle generation (hash-deduped, emailed to designated contacts)</li> <li>Systems verification (infra audit + cron audit)</li> <li>Snapshot drift detection (compare against gold snapshot, auto-save if intentional changes)</li> <li>WhatsApp summary (send backup report to user)</li> </ol> <p>Each step self-verifies and logs. Failures alert via Pushover.</p> <p>The script shown here covers steps 1-4. Steps 5-8 are advanced features you can add later as your setup matures. For now, focus on getting basic nightly backups working reliably.</p>"},{"location":"part3-infrastructure/#46-initialize-git-repository-if-not-already","title":"4.6 Initialize Git Repository (If Not Already)","text":"<pre><code>cd ~/clawd\ngit init\ngit config user.email \"bot@yourdomain.com\"\ngit config user.name \"OpenClaw Bot\"\ngit add -A\ngit commit -m \"Initial commit\"\n</code></pre> <p>Why: Git tracks all workspace changes, provides version history</p> <p>Optional: Push to GitHub for off-site redundancy:</p> <pre><code># Create private repo on GitHub, then:\ngit remote add origin git@github.com:YOUR_USERNAME/clawd-backup.git\ngit push -u origin main\n</code></pre> <p>Why: GitHub provides additional backup layer and remote access to workspace</p>"},{"location":"part3-infrastructure/#47-test-backups-manually","title":"4.7 Test Backups Manually","text":"<pre><code># Test hourly backup\n~/clawd/backup.sh\n\n# Test nightly backup\n~/clawd/scripts/nightly-backup.sh\n</code></pre> <p>Why: Verify both scripts work before scheduling</p> <p>\u2705 Verify: Scripts complete without errors, check Google Drive for uploaded files:</p> <pre><code>rclone ls gdrive-crypt:openclaw-backups/databases/\nrclone ls gdrive-crypt:openclaw-backups/full/\n</code></pre>"},{"location":"part3-infrastructure/#48-schedule-backups-in-crontab","title":"4.8 Schedule Backups in Crontab","text":"<pre><code>crontab -e\n</code></pre> <p>Select your editor (nano recommended for beginners), then add these lines:</p> <pre><code># Hourly backup (git + databases)\n0 * * * * /root/clawd/backup.sh &gt;&gt; /var/log/backup-hourly.log 2&gt;&amp;1\n\n# Nightly backup (full system) at 4 AM UTC\n0 4 * * * /root/clawd/scripts/nightly-backup.sh &gt;&gt; /var/log/backup-nightly.log 2&gt;&amp;1\n</code></pre> <p>Why: Hourly captures frequent changes, nightly creates restore points</p> <p>Save and exit (Ctrl+X, Y, Enter in nano).</p> <p>\u2705 Verify: <code>crontab -l</code> shows both backup jobs</p>"},{"location":"part3-infrastructure/#49-monitor-backup-logs","title":"4.9 Monitor Backup Logs","text":"<pre><code># View hourly backup log\ntail -f /var/log/backup-hourly.log\n\n# View nightly backup log\ntail -f /var/log/backup-nightly.log\n</code></pre> <p>Press Ctrl+C to exit tail</p> <p>\u2705 Verify: Wait for next hour, check logs show successful run</p>"},{"location":"part3-infrastructure/#part-3-complete","title":"Part 3 Complete \u2705","text":"<p>You should now have:</p> <p>Google OAuth: - [ ] Google Cloud project created - [ ] Calendar, Gmail, Drive, Sheets APIs enabled - [ ] OAuth consent screen configured (External, test users added) - [ ] Desktop app credentials created and downloaded - [ ] credentials.json installed at <code>~/.clawdbot/google/credentials.json</code> - [ ] OAuth flow completed, token.json generated - [ ] Test script confirms calendar access works - [ ] (Optional) Multiple account tokens for different Google accounts</p> <p>Cloudflare Tunnel: - [ ] cloudflared installed - [ ] Authenticated with Cloudflare account - [ ] Tunnel created (<code>cloudflared tunnel create openclaw</code>) - [ ] DNS CNAME record added (webhook.yourdomain.com) - [ ] Tunnel config routes domain to localhost:8088 - [ ] Systemd service running tunnel on boot - [ ] Public webhook URL accessible via HTTPS</p> <p>Webhook Server: - [ ] webhook-server.py created with endpoints for calendar/email/alerts - [ ] Webhook secrets generated in ~/.clawdbot/webhook.env - [ ] aiohttp Python library installed - [ ] Manual test confirms server receives requests - [ ] Systemd service runs webhook server on boot - [ ] Public webhook URL returns health check response</p> <p>Backup System: - [ ] rclone installed - [ ] Google Drive remote configured (<code>gdrive</code>) - [ ] (Optional) Encrypted remote configured (<code>gdrive-crypt</code>) - [ ] Git repository initialized in ~/clawd - [ ] backup.sh created (hourly: git + databases) - [ ] nightly-backup.sh created (full system + 7-day versioning) - [ ] Manual test backups succeeded - [ ] Both backups uploaded to Google Drive - [ ] Crontab scheduled: hourly at :00, nightly at 04:00 UTC - [ ] Backup logs created and monitored</p> <p>Next: Part 4 \u2014 Automation (cron jobs, event queue, reminders, heartbeats)</p>"},{"location":"part3-infrastructure/#quick-reference-commands","title":"Quick Reference Commands","text":"<pre><code># Google OAuth\npython3 ~/clawd/scripts/google-auth.py              # Reauthorize\npython3 ~/clawd/scripts/test-calendar.py            # Test API access\n\n# Cloudflare Tunnel\nsystemctl status cloudflared                        # Check tunnel status\nsystemctl restart cloudflared                       # Restart tunnel\ncloudflared tunnel list                             # List tunnels\njournalctl -u cloudflared -f                        # View tunnel logs\n\n# Webhook Server\nsystemctl status moltbot-webhook                    # Check webhook status\nsystemctl restart moltbot-webhook                   # Restart webhook\njournalctl -u webhook -f                            # View webhook logs\ncurl http://localhost:8088/health                   # Test local endpoint\n\n# Backups\n~/clawd/backup.sh                                   # Manual hourly backup\n~/clawd/scripts/nightly-backup.sh                   # Manual nightly backup\nrclone ls gdrive-crypt:openclaw-backups/            # List backups\ntail -f /var/log/backup-hourly.log                  # Monitor hourly backups\ntail -f /var/log/backup-nightly.log                 # Monitor nightly backups\ncrontab -l                                          # View scheduled backups\n\n# System Health\nsystemctl status cloudflared moltbot-webhook        # Check both services\njournalctl --since \"1 hour ago\" -u webhook          # Recent webhook logs\nls -lh ~/.clawdbot/google/                          # Check tokens exist\n</code></pre>"},{"location":"part3-infrastructure/#troubleshooting","title":"Troubleshooting","text":"<p>Google OAuth \"invalid_client\" error: - Verify credentials.json is correctly downloaded - Check file path: <code>~/.clawdbot/google/credentials.json</code> - Ensure OAuth consent screen is configured (test users added) - Re-download credentials from Google Cloud Console</p> <p>Google OAuth \"access_denied\" error: - Make sure your email is added as a test user - Check that all required scopes are enabled - Try using a different Google account</p> <p>Cloudflare tunnel connection refused: - Check tunnel is running: <code>systemctl status cloudflared</code> - Verify config.yml has correct tunnel UUID - Ensure DNS CNAME record exists (check Cloudflare dashboard) - Test local service first: <code>curl http://localhost:8088/health</code></p> <p>Webhook server not receiving requests: - Check service is running: <code>systemctl status moltbot-webhook</code> - Verify tunnel routes to correct port (8088) - Test locally before testing publicly - Check logs: <code>journalctl -u webhook -f</code> - Ensure webhook.env secrets are loaded</p> <p>Webhook \"Connection refused\" on public URL: - Verify Cloudflare tunnel is running - Check webhook server is listening on localhost:8088 - Test health endpoint: <code>curl https://webhook.yourdomain.com/health</code> - Check both services: <code>systemctl status cloudflared moltbot-webhook</code></p> <p>Rclone \"Failed to create file system\" error: - Re-run <code>rclone config</code> to reconfigure remote - Test authentication: <code>rclone lsd gdrive:</code> - Check Google Drive permissions (authorize in browser) - For crypt errors: verify encryption password is correct</p> <p>Backups not running from cron: - Check crontab exists: <code>crontab -l</code> - Verify script has execute permissions: <code>ls -l ~/clawd/backup.sh</code> - Check cron logs: <code>grep CRON /var/log/syslog</code> - Ensure absolute paths in cron jobs (not relative) - Test scripts manually first</p> <p>Backup script errors \"command not found\": - Cron has minimal PATH \u2014 use absolute paths (<code>/usr/bin/rclone</code>) - Add <code>PATH=/usr/local/bin:/usr/bin:/bin</code> at top of script - Or modify crontab: <code>PATH=/usr/local/bin:/usr/bin:/bin</code> before job</p> <p>Git push fails in backup: - Check remote is configured: <code>git remote -v</code> - Verify SSH keys or HTTPS credentials - Backup script continues even if git fails (non-fatal)</p>"},{"location":"part3-infrastructure/#security-notes","title":"Security Notes","text":"<p>Webhook URL Secrets: - Never commit webhook.env to git - Rotate secrets periodically: regenerate in webhook.env, restart service - Each endpoint has its own secret \u2014 limits blast radius if one leaks</p> <p>Google OAuth Tokens: - token.json contains refresh token \u2014 treat as password - Never share or commit to public repos - Rotate if compromised: revoke in Google Cloud Console \u2192 reauthorize</p> <p>Cloudflare Tunnel: - Tunnel authenticates via cert.pem \u2014 keep this file secure - Only exposes localhost:8088 \u2014 no other ports accessible - Uses HTTPS automatically \u2014 no certificate management needed</p> <p>Backup Encryption: - SAVE YOUR RCLONE CRYPT PASSWORD \u2014 no recovery without it - Consider using rclone obscure for password storage in scripts - Test restore process regularly to verify encryption works</p>"},{"location":"part3-infrastructure/#webhook-urls-reference","title":"Webhook URLs Reference","text":"<p>After setup, you'll have these public endpoints (replace YOUR_DOMAIN and secrets):</p> Purpose URL Format HTTP Method Health Check <code>https://webhook.YOUR_DOMAIN.com/health</code> GET Google Calendar <code>https://webhook.YOUR_DOMAIN.com/CALENDAR_SECRET</code> POST Email Notifications <code>https://webhook.YOUR_DOMAIN.com/email/EMAIL_SECRET</code> POST Generic Alerts <code>https://webhook.YOUR_DOMAIN.com/alerts/ALERT_SECRET</code> POST <p>To get actual URLs:</p> <pre><code>source ~/.clawdbot/webhook.env\necho \"Calendar: https://webhook.YOUR_DOMAIN.com/$WEBHOOK_CALENDAR_SECRET\"\necho \"Email: https://webhook.YOUR_DOMAIN.com/email/$WEBHOOK_EMAIL_SECRET\"\necho \"Alerts: https://webhook.YOUR_DOMAIN.com/alerts/$WEBHOOK_ALERT_SECRET\"\n</code></pre> <p>Use these URLs when configuring external services (Google Calendar watch, AgentMail, monitoring alerts)</p> <p>Estimated time: 50-70 minutes (excluding OAuth browser flows and initial backup uploads)</p>"},{"location":"part4-automation/","title":"Part 4: Automation (1 hour)","text":"<p>Prerequisites: Parts 1-3 complete (OpenClaw running, AI persona configured, webhooks active, backups scheduled)</p> <p>What you'll build: Four-layer automation system \u2014 OpenClaw cron jobs for AI-driven schedules, system crontab for infrastructure, event queue for reliable webhook processing, and heartbeat for idle-time maintenance.</p>"},{"location":"part4-automation/#1-openclaw-cron-jobs","title":"1. OpenClaw Cron Jobs","text":"<p>WHY: OpenClaw's built-in cron runs AI sessions on schedule. Each job is an isolated conversation with its own context, model, and delivery settings.</p>"},{"location":"part4-automation/#11-understanding-oc-crons","title":"1.1 Understanding OC Crons","text":"<pre><code># List all cron jobs\nopenclaw cron list\n\n# View recent runs (last 10 executions across all jobs)\nopenclaw cron runs\n\n# View runs for specific job\nopenclaw cron runs --name \"morning-agenda\"\n</code></pre> <p>Key concepts: - Each cron job spawns a fresh AI session (no conversation history) - <code>--announce</code> flag sends output to your configured chat channel (WhatsApp/Discord/etc) - <code>--model</code> overrides default model (use cheap models for routine tasks) - <code>--best-effort-deliver</code> doesn't mark job as failed if delivery temporarily fails - One-shot jobs: <code>--at \"2026-03-15 14:00\"</code> + <code>--delete-after-run</code></p>"},{"location":"part4-automation/#12-add-morning-agenda-daily-9am","title":"1.2 Add Morning Agenda (Daily 9am)","text":"<p>\u26a0\ufe0f About Timezones:</p> <p>Production OpenClaw crons use Asia/Karachi timezone (UTC+5) to avoid mental UTC math. Examples below show both UTC and timezone-aware syntax:</p> <pre><code>openclaw cron add \\\n  --name \"morning-agenda\" \\\n  --cron \"0 9 * * * @ Asia/Karachi\" \\\n  --model \"claude-sonnet-4-0\" \\\n  --announce \\\n  --best-effort-deliver \\\n  --message \"Read my calendar for today. Summarize: meetings (time, title, attendees if available), focus blocks, and any red/urgent events. Keep it under 5 lines. End with one practical tip based on my schedule density.\"\n</code></pre> <p>Syntax: <code>--cron \"CRON_EXPRESSION @ TIMEZONE\"</code></p> <p>Why timezone suffix? - <code>0 9 * * *</code> = 9am UTC = 2pm PKT (confusing!) - <code>0 9 * * * @ Asia/Karachi</code> = 9am PKT exactly (clear!)</p> <p>WHY this cron: Daily calendar summary delivered to WhatsApp at 9am local time. Uses cheap Sonnet 4.0 model. <code>--best-effort-deliver</code> prevents job from failing if WhatsApp is temporarily down.</p> <p>\u2705 Verify: <code>openclaw cron list</code> shows the job. Wait until 9am UTC or test with near-future time.</p>"},{"location":"part4-automation/#13-add-evening-wrap-up-daily-1030pm","title":"1.3 Add Evening Wrap-up (Daily 10:30pm)","text":"<pre><code>openclaw cron add \\\n  --name \"evening-wrap\" \\\n  --cron \"30 22 * * * @ Asia/Karachi\" \\\n  --model \"claude-sonnet-4-0\" \\\n  --announce \\\n  --best-effort-deliver \\\n  --message \"Read today's daily log (memory/YYYY-MM-DD.md). Summarize the day in 3 sentences: what got done, what's pending, one insight or pattern you noticed. Be honest but not harsh.\"\n</code></pre> <p>WHY: End-of-day reflection at 10:30pm local time. Helps catch incomplete tasks and patterns.</p>"},{"location":"part4-automation/#14-add-weekly-health-check-in-sunday-10am","title":"1.4 Add Weekly Health Check-in (Sunday 10am)","text":"<pre><code>openclaw cron add \\\n  --name \"health-checkin\" \\\n  --cron \"0 10 * * 0 @ Asia/Karachi\" \\\n  --model \"claude-sonnet-4-0\" \\\n  --announce \\\n  --message \"Read health-os/STATUS.md. Ask me for this week's weight, energy level (1-10), and one health win. Keep it conversational and brief.\"\n</code></pre> <p>WHY: Weekly health tracking. Sunday 10am local time catches weekend reflection window.</p>"},{"location":"part4-automation/#15-one-shot-reminder-example","title":"1.5 One-Shot Reminder Example","text":"<pre><code># Remind to call mom on her birthday (one-time, auto-delete after)\nopenclaw cron add \\\n  --name \"mom-birthday-reminder\" \\\n  --at \"2026-03-15 10:00\" \\\n  --delete-after-run \\\n  --announce \\\n  --message \"Remind: Call mom for her birthday. Suggest bringing up her garden project.\"\n</code></pre> <p>WHY: One-time reminders without cluttering the cron list. <code>--at</code> uses ISO time (YYYY-MM-DD HH:MM).</p>"},{"location":"part4-automation/#16-manage-cron-jobs","title":"1.6 Manage Cron Jobs","text":"<pre><code># Remove a job\nopenclaw cron rm --name \"morning-agenda\"\n\n# View last 20 runs with full output\nopenclaw cron runs --limit 20\n\n# Check if a specific job ran today\nopenclaw cron runs --name \"evening-wrap\" --limit 5\n</code></pre> <p>\u2705 Verify: Add a test job with <code>--at</code> 2 minutes from now. Watch it appear in <code>openclaw cron runs</code>.</p>"},{"location":"part4-automation/#2-system-crontab-infrastructure-tasks","title":"2. System Crontab (Infrastructure Tasks)","text":"<p>WHY: Traditional Linux cron for tasks that don't need AI context \u2014 backups, health checks, monitoring.</p>"},{"location":"part4-automation/#21-current-crontab","title":"2.1 Current Crontab","text":"<p>From Part 3, you already have: <pre><code>0 * * * * /root/clawd/backup.sh &gt;/dev/null 2&gt;&amp;1\n0 4 * * * /root/clawd/scripts/nightly-backup.sh\n</code></pre></p>"},{"location":"part4-automation/#22-add-tunnel-health-check-every-30min","title":"2.2 Add Tunnel Health Check (Every 30min)","text":"<pre><code>crontab -e\n</code></pre> <p>Add this line: <pre><code>*/30 * * * * curl -s -o /dev/null -w \"%{http_code}\" https://webhook.yourdomain.com/health || echo \"Tunnel down: $(date)\" &gt;&gt; /root/clawd/memory/system-health.log\n</code></pre></p> <p>WHY: Cloudflare tunnel occasionally drops. This catches outages. Logs to <code>system-health.log</code> only on failure.</p>"},{"location":"part4-automation/#23-understanding-cron-delivery-critical-concept","title":"2.3 Understanding Cron Delivery (Critical Concept)","text":"<p>The Problem:</p> <p>Early OpenClaw setups used <code>--announce</code> to deliver cron output. When WhatsApp hiccups, the job would fail even though the work completed successfully. False failures are noisy and undermine trust in your system.</p> <p>The Evolution:</p> <ol> <li>v1: <code>--announce</code> only \u2192 false failures on transient network issues</li> <li>v2: Added <code>--best-effort-deliver</code> \u2192 swallows delivery failures, but now critical messages can vanish silently</li> <li>v3 (Current Production): Two-tier architecture</li> </ol> <p>Production Architecture (as of 2026-02-25):</p> <p>ALL 35+ OpenClaw crons have <code>--best-effort-deliver</code> \u2014 job never fails due to delivery issues.</p> <p>But how do critical messages get delivered?</p>"},{"location":"part4-automation/#24-two-tier-cron-delivery","title":"2.4 Two-Tier Cron Delivery","text":"<p>Tier 1 \u2014 Critical Messages (29 crons):</p> <p>Add a MANDATORY directive telling the agent to send via <code>message</code> tool as part of its task, not relying on announce:</p> <pre><code>openclaw cron add \\\n  --name \"morning-agenda\" \\\n  --cron \"0 9 * * * @ Asia/Karachi\" \\\n  --model \"claude-sonnet-4-5\" \\\n  --announce \\\n  --best-effort-deliver \\\n  --message \"Read my calendar for today. Summarize meetings, focus blocks, urgent events. Keep it under 5 lines.\n\n\u26a0\ufe0f MANDATORY: You MUST send your output via the message tool (action=send) as part of your task. Announce delivery is a redundant backup only. If message tool send fails, retry once. This is your PRIMARY delivery mechanism.\"\n</code></pre> <p>Why this works: - Agent sends via <code>message</code> tool = part of task execution - If message tool fails, agent retries (task-level failure recovery) - Announce is just a backup (if it fails, no biggie \u2014 message tool already delivered) - <code>--best-effort-deliver</code> prevents job from showing as \"failed\" if announce hiccups</p> <p>Tier 2 \u2014 Background Jobs (6 crons):</p> <p>Jobs like <code>event-queue-processor</code>, <code>agentmail-health-check</code>, <code>calendar-webhook-renew</code> don't need delivery: - They do work silently (process queue, renew webhook, etc.) - No output to deliver - If the JOB fails (agent error), that's caught by the monitor (next section) - If delivery fails, who cares \u2014 there was no output anyway</p> <p>Key Insight: Delivery failure \u2260 job failure. With <code>--best-effort-deliver</code>, only REAL failures (agent crashes, task errors) are flagged.</p>"},{"location":"part4-automation/#25-add-cron-failure-monitor-every-5min","title":"2.5 Add Cron Failure Monitor (Every 5min)","text":"<p>Purpose: With <code>--best-effort-deliver</code> on all crons, delivery failures are silently swallowed (by design \u2014 they're not real failures). This monitor catches REAL job failures: when the agent itself errors out, task fails, or model crashes. Those need alerting.</p> <pre><code>cat &gt; /root/clawd/scripts/cron-delivery-monitor.py &lt;&lt; 'PYEOF'\n#!/usr/bin/env python3\n\"\"\"\nCron Failure Monitor: detects real job failures (not delivery failures).\nWith bestEffort=true, delivery failures are swallowed. Critical crons send\nvia message tool directly, so announce is just a bonus.\nThis catches when the cron agent itself errors out.\n\"\"\"\nimport json, os, subprocess, sys\nfrom datetime import datetime, timezone\n\nSTATE_FILE = os.path.expanduser(\"~/.clawdbot/cron-delivery-state.json\")\nEVENT_QUEUE = \"/root/clawd/scripts/event-queue.py\"\nBACKGROUND_JOBS = {\n    \"event-queue-processor\", \"agentmail-health-check\",\n    \"calendar-webhook-renew\", \"red-meeting-reconcile\",\n    \"github-release-monitor\",\n}\n\ndef load_state():\n    try:\n        with open(STATE_FILE) as f:\n            return set(tuple(x) for x in json.load(f))\n    except (FileNotFoundError, json.JSONDecodeError):\n        return set()\n\ndef save_state(state):\n    os.makedirs(os.path.dirname(STATE_FILE), exist_ok=True)\n    recent = sorted(state, key=lambda x: x[1], reverse=True)[:200]\n    with open(STATE_FILE, \"w\") as f:\n        json.dump(list(recent), f)\n\ndef main():\n    state = load_state()\n    r = subprocess.run([\"openclaw\", \"cron\", \"list\", \"--json\"],\n                       capture_output=True, text=True, timeout=30)\n    jobs = json.loads(r.stdout).get(\"jobs\", [])\n    alerts = []\n\n    for job in jobs:\n        s = job.get(\"state\", {})\n        if s.get(\"lastStatus\") != \"error\":\n            continue\n        key = (job[\"id\"], str(s.get(\"lastRunAtMs\", \"\")))\n        if key in state:\n            continue\n        error = s.get(\"lastError\", \"\")\n        name = job[\"name\"]\n        is_bg = name in BACKGROUND_JOBS\n        emoji = \"\u26a0\ufe0f\" if is_bg else \"\ud83d\udd34\"\n        consec = s.get(\"consecutiveErrors\", 0)\n        msg = f\"{emoji} *Cron failed:* {name}\"\n        if consec &gt; 1:\n            msg += f\" ({consec}x)\"\n        msg += f\"\\nError: {error[:200]}\"\n        alerts.append(msg)\n        state.add(key)\n\n    save_state(state)\n    if alerts:\n        payload = json.dumps({\"message\": \"\\n\\n\".join(alerts), \"source\": \"cron-monitor\"})\n        subprocess.run([\"python3\", EVENT_QUEUE, \"push\",\n                        \"--type\", \"cron-delivery\", \"--source\", \"cron-monitor\",\n                        \"--payload\", payload, \"--priority\", \"5\"],\n                       capture_output=True, text=True, timeout=10)\n        print(f\"{len(alerts)} failure(s) queued\")\n    else:\n        print(\"No new failures\")\n\nif __name__ == \"__main__\":\n    main()\nPYEOF\n\nchmod +x /root/clawd/scripts/cron-delivery-monitor.py\n</code></pre> <p>Add to crontab: <pre><code>crontab -e\n</code></pre></p> <p>Add: <pre><code>*/5 * * * * /usr/bin/python3 /root/clawd/scripts/cron-delivery-monitor.py &gt;&gt; /tmp/cron-delivery-monitor.log 2&gt;&amp;1\n</code></pre></p> <p>WHY: No real job failure goes unnoticed. Delivery failures are harmless (critical crons send directly). Background job failures still get flagged.</p> <p>\u2705 Verify: <code>crontab -l</code> shows all 4 jobs (hourly backup, nightly backup, tunnel check, failure monitor).</p>"},{"location":"part4-automation/#3-event-queue-reliable-webhook-processing","title":"3. Event Queue (Reliable Webhook Processing)","text":"<p>WHY: Webhooks are ephemeral \u2014 if the AI is busy or delivery fails, the event is lost. The event queue adds persistence, retries, and dead-letter alerting.</p>"},{"location":"part4-automation/#31-create-event-queue-database","title":"3.1 Create Event Queue Database","text":"<pre><code>mkdir -p ~/.clawdbot\ncat &gt; /root/clawd/scripts/event-queue.py &lt;&lt; 'EOF'\n#!/usr/bin/env python3\n\"\"\"\nEvent Queue: SQLite-backed persistent queue with retry logic.\nHandles webhook events (email, calendar, alerts) and failed cron deliveries.\n\"\"\"\nimport sqlite3\nimport json\nimport argparse\nfrom datetime import datetime, timedelta\nfrom pathlib import Path\n\nDB_PATH = Path.home() / \".clawdbot\" / \"event-queue.sqlite\"\n\ndef init_db():\n    \"\"\"Create queue table if not exists.\"\"\"\n    conn = sqlite3.connect(DB_PATH)\n    conn.execute(\"\"\"\n        CREATE TABLE IF NOT EXISTS events (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            type TEXT NOT NULL,\n            source TEXT NOT NULL,\n            payload TEXT NOT NULL,\n            status TEXT DEFAULT 'pending',\n            attempts INTEGER DEFAULT 0,\n            created_at TEXT DEFAULT CURRENT_TIMESTAMP,\n            last_attempt TEXT,\n            error TEXT\n        )\n    \"\"\")\n    conn.commit()\n    conn.close()\n\ndef push_event(event_type, source, payload):\n    \"\"\"Add event to queue.\"\"\"\n    conn = sqlite3.connect(DB_PATH)\n    conn.execute(\n        \"INSERT INTO events (type, source, payload) VALUES (?, ?, ?)\",\n        (event_type, source, json.dumps(payload))\n    )\n    conn.commit()\n    event_id = conn.execute(\"SELECT last_insert_rowid()\").fetchone()[0]\n    conn.close()\n    print(f\"Event {event_id} queued: {event_type} from {source}\")\n\ndef process_events():\n    \"\"\"Process pending events with retry logic.\"\"\"\n    conn = sqlite3.connect(DB_PATH)\n    events = conn.execute(\n        \"SELECT id, type, source, payload, attempts FROM events WHERE status = 'pending' AND attempts &lt; 3\"\n    ).fetchall()\n\n    for event_id, etype, source, payload, attempts in events:\n        print(f\"Processing event {event_id} (attempt {attempts + 1}/3)\")\n\n        try:\n            # TODO: Actual processing logic here\n            # For skeleton: just simulate success/failure\n            success = True  # Replace with real processing\n\n            if success:\n                conn.execute(\"UPDATE events SET status = 'success' WHERE id = ?\", (event_id,))\n            else:\n                raise Exception(\"Processing failed\")\n\n        except Exception as e:\n            new_attempts = attempts + 1\n            if new_attempts &gt;= 3:\n                conn.execute(\n                    \"UPDATE events SET status = 'dead', attempts = ?, error = ? WHERE id = ?\",\n                    (new_attempts, str(e), event_id)\n                )\n                print(f\"Event {event_id} moved to dead letter (3 failures)\")\n            else:\n                conn.execute(\n                    \"UPDATE events SET attempts = ?, last_attempt = ?, error = ? WHERE id = ?\",\n                    (new_attempts, datetime.utcnow().isoformat(), str(e), event_id)\n                )\n\n    conn.commit()\n    conn.close()\n\ndef status():\n    \"\"\"Show queue statistics.\"\"\"\n    conn = sqlite3.connect(DB_PATH)\n    stats = conn.execute(\"\"\"\n        SELECT status, COUNT(*) FROM events GROUP BY status\n    \"\"\").fetchall()\n    conn.close()\n\n    print(\"Queue Status:\")\n    for status, count in stats:\n        print(f\"  {status}: {count}\")\n\ndef dead_letters():\n    \"\"\"Show dead letter events.\"\"\"\n    conn = sqlite3.connect(DB_PATH)\n    dead = conn.execute(\n        \"SELECT id, type, source, created_at, error FROM events WHERE status = 'dead'\"\n    ).fetchall()\n    conn.close()\n\n    if not dead:\n        print(\"No dead letter events\")\n    else:\n        for event_id, etype, source, created, error in dead:\n            print(f\"{event_id}: {etype} from {source} ({created}) - {error}\")\n\ndef retry(event_id):\n    \"\"\"Retry a dead letter event.\"\"\"\n    conn = sqlite3.connect(DB_PATH)\n    conn.execute(\n        \"UPDATE events SET status = 'pending', attempts = 0 WHERE id = ?\",\n        (event_id,)\n    )\n    conn.commit()\n    conn.close()\n    print(f\"Event {event_id} reset to pending\")\n\nif __name__ == \"__main__\":\n    init_db()\n\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"action\", choices=[\"push\", \"process\", \"status\", \"dead\", \"retry\"])\n    parser.add_argument(\"--type\", help=\"Event type (push)\")\n    parser.add_argument(\"--source\", help=\"Event source (push)\")\n    parser.add_argument(\"--payload\", help=\"JSON payload (push)\")\n    parser.add_argument(\"--id\", type=int, help=\"Event ID (retry)\")\n    parser.add_argument(\"--all\", action=\"store_true\", help=\"Process all pending (process)\")\n\n    args = parser.parse_args()\n\n    if args.action == \"push\":\n        push_event(args.type, args.source, json.loads(args.payload))\n    elif args.action == \"process\":\n        process_events()\n    elif args.action == \"status\":\n        status()\n    elif args.action == \"dead\":\n        dead_letters()\n    elif args.action == \"retry\":\n        retry(args.id)\nEOF\n\nchmod +x /root/clawd/scripts/event-queue.py\n</code></pre> <p>WHY: Skeleton shows the pattern \u2014 init DB, push events, process with retries, handle dead letters. Production version would add actual webhook processing logic in <code>process_events()</code>.</p>"},{"location":"part4-automation/#32-initialize-queue","title":"3.2 Initialize Queue","text":"<pre><code>python3 /root/clawd/scripts/event-queue.py status\n</code></pre> <p>WHY: First run creates the SQLite database at <code>~/.clawdbot/event-queue.sqlite</code>.</p> <p>\u2705 Verify: <code>ls -lh ~/.clawdbot/event-queue.sqlite</code> shows the database file.</p>"},{"location":"part4-automation/#33-test-the-queue","title":"3.3 Test the Queue","text":"<pre><code># Push a test event\npython3 /root/clawd/scripts/event-queue.py push \\\n  --type \"test\" \\\n  --source \"manual\" \\\n  --payload '{\"message\": \"queue test\"}'\n\n# Check status\npython3 /root/clawd/scripts/event-queue.py status\n\n# Process pending\npython3 /root/clawd/scripts/event-queue.py process --all\n\n# Check again\npython3 /root/clawd/scripts/event-queue.py status\n</code></pre> <p>\u2705 Verify: Status shows 1 success event after processing.</p>"},{"location":"part4-automation/#34-schedule-queue-processor-oc-cron","title":"3.4 Schedule Queue Processor (OC Cron)","text":"<pre><code>openclaw cron add \\\n  --name \"event-queue-processor\" \\\n  --cron \"*/15 * * * *\" \\\n  --model \"claude-sonnet-4-0\" \\\n  --message \"Run: python3 /root/clawd/scripts/event-queue.py process --all. If there are dead letter events (check with 'dead' command), alert me with details.\"\n</code></pre> <p>WHY: Processes queue every 15 minutes. AI can inspect dead letters and alert you.</p>"},{"location":"part4-automation/#35-dead-letter-alerting","title":"3.5 Dead Letter Alerting","text":"<pre><code># Check for dead letters\npython3 /root/clawd/scripts/event-queue.py dead\n\n# Retry a specific event\npython3 /root/clawd/scripts/event-queue.py retry --id 5\n</code></pre> <p>WHY: If an event fails 3 times, it moves to dead letter queue. You can manually inspect and retry.</p> <p>\u2705 Verify: <code>openclaw cron list</code> shows the queue processor job.</p>"},{"location":"part4-automation/#4-heartbeat-system","title":"4. Heartbeat System","text":"<p>WHY: OpenClaw can poll your AI periodically during idle time (no active conversations). Heartbeats are for maintenance tasks that need conversation context but don't need exact timing.</p>"},{"location":"part4-automation/#41-understanding-heartbeats","title":"4.1 Understanding Heartbeats","text":"<p>Heartbeat vs Cron: - Cron: Exact timing, isolated session, different model, one-shot reminders - Heartbeat: Batch checks, needs conversation context, timing can drift (every ~30-60min when idle)</p> <p>Typical heartbeat tasks: - Check calendar for imminent events - Process event queue - Verify service health - Check context usage - Update daily log</p>"},{"location":"part4-automation/#42-create-heartbeatmd","title":"4.2 Create HEARTBEAT.md","text":"<pre><code>cat &gt; /root/clawd/HEARTBEAT.md &lt;&lt; 'EOF'\n# HEARTBEAT.md - Idle-Time Maintenance\n\nRun these checks every heartbeat (when idle, ~30-60min intervals).\n\n## Priority Checks (Always)\n\n1. **Calendar Urgency**\n   - Read calendar for next 2 hours\n   - If red event or meeting &lt;30min away, alert via WhatsApp\n   - Check for event changes since last heartbeat\n\n2. **Event Queue**\n   - Run: `python3 scripts/event-queue.py status`\n   - If pending &gt;10 or any dead letters, process immediately\n\n3. **Service Health** (Quick check only)\n   - Check tunnel: `curl -s -o /dev/null -w \"%{http_code}\" https://webhook.yourdomain.com/health`\n   - If down, log to `memory/system-health.log`\n\n## Secondary Checks (When Time Permits)\n\n4. **Context Usage**\n   - If &gt;150K tokens used, note in daily log\n   - Consider compacting if &gt;180K\n\n5. **Daily Log**\n   - If last entry &gt;4 hours old during work hours (9am-10pm UTC), note the gap\n\n## Quiet Hours\n\n**23:00-08:00 UTC:** Only Priority #1 (urgent calendar events). Skip everything else.\n\n## Notes\n\n- Heartbeats are best-effort, not guaranteed\n- Don't be annoying \u2014 log issues, alert only urgent\n- If processing takes &gt;30s, defer to next heartbeat\nEOF\n</code></pre> <p>WHY: Centralized list of heartbeat tasks. AI reads this on each poll.</p>"},{"location":"part4-automation/#43-configure-openclaw-heartbeat","title":"4.3 Configure OpenClaw Heartbeat","text":"<p>OpenClaw handles heartbeat timing automatically. You configure it in <code>openclaw.json</code>:</p> <pre><code># Edit OpenClaw config\nnano ~/.openclaw/openclaw.json\n</code></pre> <p>Add/verify this section: <pre><code>{\n  \"heartbeat\": {\n    \"enabled\": true,\n    \"intervalMinutes\": 45,\n    \"quietHoursStart\": \"23:00\",\n    \"quietHoursEnd\": \"08:00\"\n  }\n}\n</code></pre></p> <p>WHY: Heartbeat every 45 minutes when idle. Quiet hours prevent nighttime spam.</p> <p>Restart OpenClaw: <pre><code>openclaw gateway restart\n</code></pre></p> <p>\u2705 Verify: After 45 minutes of idle time, check your chat for a heartbeat check-in (or check <code>openclaw logs</code>).</p>"},{"location":"part4-automation/#44-test-heartbeat-manually","title":"4.4 Test Heartbeat Manually","text":"<pre><code># Trigger immediate heartbeat (if OpenClaw supports it)\nopenclaw heartbeat --now\n</code></pre> <p>WHY: Tests heartbeat logic without waiting 45 minutes.</p>"},{"location":"part4-automation/#part-4-complete-checklist","title":"Part 4 Complete Checklist","text":"<p>\u2705 OpenClaw Cron Jobs: - [ ] <code>openclaw cron list</code> shows morning-agenda, evening-wrap, health-checkin - [ ] Tested one-shot reminder with <code>--at</code> and <code>--delete-after-run</code> - [ ] <code>openclaw cron runs</code> shows recent executions</p> <p>\u2705 System Crontab: - [ ] <code>crontab -l</code> shows 4 jobs: hourly backup, nightly backup, tunnel check, delivery monitor - [ ] Tunnel health check logs only on failure - [ ] Delivery monitor script created and executable</p> <p>\u2705 Event Queue: - [ ] Database created at <code>~/.clawdbot/event-queue.sqlite</code> - [ ] Tested push/process/status/dead/retry commands - [ ] OC cron job processes queue every 15min - [ ] Dead letter alerting works</p> <p>\u2705 Heartbeat System: - [ ] <code>HEARTBEAT.md</code> created with task list - [ ] <code>openclaw.json</code> configured with heartbeat settings - [ ] Quiet hours set (23:00-08:00 UTC) - [ ] First heartbeat executed after 45min idle</p> <p>What you built: Four-layer automation \u2014 AI-driven schedules (OC cron), infrastructure tasks (system cron), reliable event processing (queue), and idle-time maintenance (heartbeat). No event is lost, no reminder is missed, and the system self-monitors.</p> <p>Next: Part 5 \u2014 Hardening (CrowdSec, secret rotation, config snapshots, recovery scripts)</p> <p>Time estimate: 1 hour (30min for cron setup, 20min for event queue, 10min for heartbeat)</p> <p>Difficulty: Intermediate \u2014 requires understanding of cron syntax, SQLite basics, and AI session isolation concepts.</p>"},{"location":"part5-hardening/","title":"Part 5: Hardening (30 min)","text":"<p>Prerequisites: Parts 1-4 complete (OpenClaw running, AI persona configured, infrastructure deployed, automation active)</p> <p>What you'll build: Production-grade hardening layer \u2014 intrusion detection (CrowdSec), secret rotation protocol, config snapshots, three-tier recovery system, and WhatsApp scope verification to prevent pairing loops.</p>"},{"location":"part5-hardening/#1-crowdsec-intrusion-detection-prevention","title":"1. CrowdSec (Intrusion Detection &amp; Prevention)","text":"<p>WHY: CrowdSec monitors your logs for attack patterns (SSH brute force, port scans, exploit attempts) and automatically bans malicious IPs via firewall. It's like fail2ban but crowd-sourced \u2014 you benefit from attack intelligence shared by 70,000+ servers.</p>"},{"location":"part5-hardening/#11-install-crowdsec","title":"1.1 Install CrowdSec","text":"<pre><code># Add CrowdSec repository\ncurl -s https://packagecloud.io/install/repositories/crowdsec/crowdsec/script.deb.sh | bash\n\n# Install CrowdSec engine\napt install -y crowdsec\n</code></pre> <p>Why: CrowdSec is the detection engine that parses logs and identifies threats</p> <p>\u2705 Verify: <code>systemctl status crowdsec</code> shows \"active (running)\"</p>"},{"location":"part5-hardening/#12-install-firewall-bouncer","title":"1.2 Install Firewall Bouncer","text":"<pre><code># Install iptables bouncer (integrates with UFW)\napt install -y crowdsec-firewall-bouncer-iptables\n</code></pre> <p>Why: The bouncer is the enforcement layer \u2014 it translates CrowdSec's ban decisions into actual firewall rules</p> <p>\u2705 Verify: <code>systemctl status crowdsec-firewall-bouncer</code> shows \"active (running)\"</p>"},{"location":"part5-hardening/#13-how-it-works","title":"1.3 How It Works","text":"<p>Detection flow: 1. CrowdSec tails <code>/var/log/auth.log</code>, <code>/var/log/nginx/access.log</code>, etc. 2. Parsers identify attack patterns (5 failed SSH logins in 2 minutes = brute force) 3. Scenarios trigger decisions (ban IP for 4 hours) 4. Bouncer applies the ban via iptables/UFW</p> <p>Community intelligence: - CrowdSec shares anonymized attack data with the community - You receive blocklists of known malicious IPs (automatic, opt-out via config) - Your server contributes to global threat intelligence</p>"},{"location":"part5-hardening/#14-verify-crowdsec-operation","title":"1.4 Verify CrowdSec Operation","text":"<pre><code># Check active bans\ncscli decisions list\n\n# View parsed logs and metrics\ncscli metrics\n\n# List installed parsers (should include sshd)\ncscli parsers list\n\n# List active scenarios\ncscli scenarios list\n</code></pre> <p>Why: Confirms CrowdSec is processing logs and ready to ban attackers</p> <p>\u2705 Verify: <code>cscli metrics</code> shows non-zero \"Lines parsed\" count, <code>cscli decisions list</code> may show active bans (or be empty if no attacks yet)</p>"},{"location":"part5-hardening/#15-test-crowdsec-optional","title":"1.5 Test CrowdSec (Optional)","text":"<p>From your local machine, trigger a fake attack:</p> <pre><code># Attempt 6 failed SSH logins (will trigger ban after 5)\nfor i in {1..6}; do ssh fakeuser@YOUR_SERVER_IP; sleep 1; done\n</code></pre> <p>On the server:</p> <pre><code># Check if your IP was banned\ncscli decisions list\n\n# Remove the ban (so you can still connect)\ncscli decisions delete --ip YOUR_LOCAL_IP\n</code></pre> <p>Why: Validates the detection \u2192 ban \u2192 enforcement pipeline</p> <p>\u26a0\ufe0f SAFETY: Only test from an IP you control. Use <code>cscli decisions delete</code> to unban yourself.</p>"},{"location":"part5-hardening/#2-secrets-hygiene","title":"2. Secrets Hygiene","text":"<p>Rule: NEVER hardcode secrets in scripts. All API keys, tokens, and credentials go in <code>~/.clawdbot/webhook.env</code> (chmod 600, gitignored). Scripts source from env:</p> <ul> <li>Shell scripts: <code>source ~/.clawdbot/webhook.env</code> then use <code>$PUSHOVER_TOKEN</code>, <code>$GROQ_API_KEY</code>, etc.</li> <li>Python scripts: <code>from dotenv import load_dotenv; load_dotenv(os.path.expanduser(\"~/.clawdbot/webhook.env\"))</code> then <code>os.environ.get(\"KEY\")</code></li> </ul> <p>WHY: Your workspace is git-backed (hourly push). Hardcoded secrets in scripts = secrets in git history. Even in a private repo, this is a leak waiting to happen. Git history is permanent; <code>webhook.env</code> is gitignored and never leaves the server.</p> <p>Ensure <code>.gitignore</code> includes: <pre><code>.env\n*.key\n</code></pre></p> <p>And verify no secrets are tracked: <code>git ls-files | xargs grep -l \"sk_\\|gsk_\\|token=\" 2&gt;/dev/null</code></p>"},{"location":"part5-hardening/#3-secret-rotation-protocol","title":"3. Secret Rotation Protocol","text":"<p>WHY: Credentials decay. A compromised token 6 months old can bypass all your other security. Rotation limits the blast radius of any single leak.</p>"},{"location":"part5-hardening/#21-rotation-schedule","title":"2.1 Rotation Schedule","text":"<p>Create a checklist in your workspace:</p> <pre><code>nano /root/clawd/SECURITY.md\n</code></pre> <p>Add this section:</p> <pre><code># Secret Rotation Schedule\n\n| Secret | Frequency | Last Rotated | Next Due |\n|--------|-----------|--------------|----------|\n| OpenClaw Gateway Token | 90 days | 2026-02-22 | 2026-05-23 |\n| Webhook URL Secrets | 90 days | 2026-02-22 | 2026-05-23 |\n| Google OAuth Tokens | Auto-refresh | (health checked daily) | N/A |\n| SSH Keys | 365 days | 2026-02-22 | 2027-02-22 |\n| Hetzner API Token | 365 days | 2026-02-22 | 2027-02-22 |\n| Pushover Keys | Never (until compromised) | N/A | N/A |\n\n## Rotation Procedures\n\n### OpenClaw Gateway Token\n1. Generate new token: `openclaw gateway token --new`\n2. Update `~/.openclaw/config.json` \u2192 `gatewayToken` field\n3. Restart gateway: `openclaw gateway restart`\n4. Test: Send WhatsApp message, verify response\n\n### Webhook URL Secrets\n1. Generate new secret: `openssl rand -hex 16`\n2. Update `~/.clawdbot/webhook.env` \u2192 endpoint paths\n3. Update Cloudflare tunnel config (if paths changed)\n4. Restart webhook: `systemctl restart openclaw-webhook`\n5. Re-register Google Calendar webhook with new URL\n6. Test: Trigger calendar event, verify delivery\n\n### SSH Keys\n1. On local machine: `ssh-keygen -t ed25519 -f ~/.ssh/id_openclaw_new`\n2. Add new key to Hetzner console\n3. Add new key to server: `~/.ssh/authorized_keys`\n4. Test connection with new key\n5. Remove old key from `authorized_keys` and Hetzner\n6. Delete old local private key\n\n### Google OAuth Tokens\n- **Auto-refresh:** Tokens refresh automatically when expired\n- **Health check:** `scripts/service-quick-check.py` validates tokens daily\n- **Manual refresh:** `scripts/google-reauth.py &lt;account&gt;` forces re-auth\n</code></pre> <p>Why: Written procedures prevent \"how do I rotate this again?\" delays when tokens expire</p>"},{"location":"part5-hardening/#22-rotate-openclaw-gateway-token-example","title":"2.2 Rotate OpenClaw Gateway Token (Example)","text":"<pre><code># Generate new token (outputs token to terminal)\nopenclaw gateway token --new\n\n# Copy the token, then edit config\nnano ~/.openclaw/config.json\n</code></pre> <p>Find the <code>gatewayToken</code> field and replace with new token:</p> <pre><code>{\n  \"gatewayToken\": \"NEW_TOKEN_HERE\",\n  \"whatsapp\": { ... }\n}\n</code></pre> <p>Save and restart:</p> <pre><code>openclaw gateway restart\nopenclaw gateway status\n</code></pre> <p>\u2705 Verify: Send a WhatsApp message, confirm bot responds</p>"},{"location":"part5-hardening/#23-rotate-webhook-secrets-example","title":"2.3 Rotate Webhook Secrets (Example)","text":"<pre><code># Generate new secret\nopenssl rand -hex 16\n\n# Edit webhook env\nnano ~/.clawdbot/webhook.env\n</code></pre> <p>Update the endpoint paths with new secret:</p> <pre><code>CALENDAR_WEBHOOK_PATH=\"/NEW_SECRET_HERE\"\nALERTS_WEBHOOK_PATH=\"/alerts/NEW_SECRET_HERE\"\nAGENTMAIL_WEBHOOK_PATH=\"/agentmail/NEW_SECRET_HERE\"\n</code></pre> <p>Restart webhook server:</p> <pre><code>systemctl restart openclaw-webhook\nsystemctl status openclaw-webhook\n</code></pre> <p>Then update external services: - Google Calendar: Re-register webhook with new URL - Alert services: Update webhook destination - AgentMail: Update forwarding URL</p> <p>\u2705 Verify: Trigger a test event for each webhook, confirm delivery</p>"},{"location":"part5-hardening/#24-rotation-script-skeleton","title":"2.4 Rotation Script Skeleton","text":"<p>Create a helper script for automated rotation reminders:</p> <pre><code>nano /root/clawd/scripts/rotation-check.py\n</code></pre> <pre><code>#!/usr/bin/env python3\n\"\"\"Check secret rotation schedule and alert if any are due.\"\"\"\n\nfrom datetime import datetime, timedelta\nimport sys\n\nSECRETS = {\n    \"OpenClaw Gateway Token\": {\"frequency\": 90, \"last\": \"2026-02-22\"},\n    \"Webhook URL Secrets\": {\"frequency\": 90, \"last\": \"2026-02-22\"},\n    \"SSH Keys\": {\"frequency\": 365, \"last\": \"2026-02-22\"},\n}\n\ndef check_rotation():\n    today = datetime.now()\n    alerts = []\n\n    for name, config in SECRETS.items():\n        last_rotated = datetime.strptime(config[\"last\"], \"%Y-%m-%d\")\n        next_due = last_rotated + timedelta(days=config[\"frequency\"])\n        days_until = (next_due - today).days\n\n        if days_until &lt;= 7:\n            alerts.append(f\"\u26a0\ufe0f {name} due in {days_until} days (rotate by {next_due.date()})\")\n        elif days_until &lt; 0:\n            alerts.append(f\"\ud83d\udea8 {name} OVERDUE by {abs(days_until)} days!\")\n\n    if alerts:\n        print(\"\\n\".join(alerts))\n        return 1\n    else:\n        print(\"\u2705 All secrets current\")\n        return 0\n\nif __name__ == \"__main__\":\n    sys.exit(check_rotation())\n</code></pre> <p>Make executable:</p> <pre><code>chmod +x /root/clawd/scripts/rotation-check.py\n</code></pre> <p>Add to daily cron (system crontab):</p> <pre><code>crontab -e\n</code></pre> <p>Add line:</p> <pre><code>0 10 * * * /root/clawd/scripts/rotation-check.py &gt;&gt; /root/clawd/memory/system-health.log 2&gt;&amp;1\n</code></pre> <p>Why: Daily check alerts you 7 days before rotation is due, preventing expired credentials</p>"},{"location":"part5-hardening/#4-config-snapshots","title":"4. Config Snapshots","text":"<p>WHY: Configuration drift is silent. You change a setting, restart a service, something breaks, and you can't remember what worked. Snapshots give you a \"gold standard\" to restore in 3 seconds.</p>"},{"location":"part5-hardening/#31-create-snapshot-script","title":"3.1 Create Snapshot Script","text":"<pre><code>nano /root/clawd/scripts/restore-snapshot-config.sh\n</code></pre> <pre><code>#!/bin/bash\n# restore-snapshot-config.sh - Save/restore config snapshots\n\nSNAPSHOT_DIR=\"$HOME/.clawdbot/snapshots\"\nLATEST_LINK=\"$SNAPSHOT_DIR/latest\"\n\nsave_snapshot() {\n    local LABEL=\"${1:-manual-$(date +%Y%m%d-%H%M%S)}\"\n    local SNAP_PATH=\"$SNAPSHOT_DIR/$LABEL\"\n\n    mkdir -p \"$SNAP_PATH\"\n\n    echo \"\ud83d\udcf8 Saving snapshot: $LABEL\"\n\n    # OpenClaw config\n    if [ -f \"$HOME/.openclaw/config.json\" ]; then\n        cp \"$HOME/.openclaw/config.json\" \"$SNAP_PATH/openclaw.json\"\n        echo \"  \u2713 openclaw.json\"\n    fi\n\n    # Systemd services\n    mkdir -p \"$SNAP_PATH/systemd\"\n    for service in openclaw-webhook.service; do\n        if [ -f \"/etc/systemd/system/$service\" ]; then\n            cp \"/etc/systemd/system/$service\" \"$SNAP_PATH/systemd/\"\n            echo \"  \u2713 $service\"\n        fi\n    done\n\n    # SSH config\n    if [ -f \"/etc/ssh/sshd_config\" ]; then\n        cp \"/etc/ssh/sshd_config\" \"$SNAP_PATH/sshd_config\"\n        echo \"  \u2713 sshd_config\"\n    fi\n\n    # Crontab\n    crontab -l &gt; \"$SNAP_PATH/crontab.txt\" 2&gt;/dev/null\n    echo \"  \u2713 crontab\"\n\n    # UFW rules\n    ufw status numbered &gt; \"$SNAP_PATH/ufw-rules.txt\" 2&gt;/dev/null\n    echo \"  \u2713 ufw-rules\"\n\n    # Update 'latest' symlink\n    rm -f \"$LATEST_LINK\"\n    ln -s \"$SNAP_PATH\" \"$LATEST_LINK\"\n\n    echo \"\u2705 Snapshot saved: $SNAP_PATH\"\n    echo \"   Restore with: $0 restore $LABEL\"\n}\n\nrestore_snapshot() {\n    local LABEL=\"${1:-latest}\"\n    local SNAP_PATH=\"$SNAPSHOT_DIR/$LABEL\"\n\n    if [ ! -d \"$SNAP_PATH\" ]; then\n        echo \"\u274c Snapshot not found: $LABEL\"\n        echo \"Available snapshots:\"\n        ls -1 \"$SNAPSHOT_DIR\" | grep -v latest\n        exit 1\n    fi\n\n    echo \"\u26a0\ufe0f  Restoring snapshot: $LABEL\"\n    read -p \"This will overwrite current config. Continue? (yes/no): \" confirm\n\n    if [ \"$confirm\" != \"yes\" ]; then\n        echo \"Aborted.\"\n        exit 0\n    fi\n\n    # Restore OpenClaw config\n    if [ -f \"$SNAP_PATH/openclaw.json\" ]; then\n        cp \"$SNAP_PATH/openclaw.json\" \"$HOME/.openclaw/config.json\"\n        echo \"  \u2713 openclaw.json restored\"\n    fi\n\n    # Restore systemd services\n    if [ -d \"$SNAP_PATH/systemd\" ]; then\n        cp \"$SNAP_PATH/systemd/\"* /etc/systemd/system/\n        systemctl daemon-reload\n        echo \"  \u2713 systemd services restored\"\n    fi\n\n    # Restore SSH config\n    if [ -f \"$SNAP_PATH/sshd_config\" ]; then\n        cp \"$SNAP_PATH/sshd_config\" /etc/ssh/sshd_config\n        echo \"  \u2713 sshd_config restored (restart sshd manually)\"\n    fi\n\n    # Restore crontab\n    if [ -f \"$SNAP_PATH/crontab.txt\" ]; then\n        crontab \"$SNAP_PATH/crontab.txt\"\n        echo \"  \u2713 crontab restored\"\n    fi\n\n    echo \"\u2705 Snapshot restored. Restart services as needed.\"\n    echo \"   Suggested: openclaw gateway restart &amp;&amp; systemctl restart openclaw-webhook\"\n}\n\nlist_snapshots() {\n    echo \"Available snapshots:\"\n    ls -1t \"$SNAPSHOT_DIR\" | grep -v latest | while read snap; do\n        echo \"  - $snap\"\n    done\n}\n\ncase \"${1:-help}\" in\n    save)\n        save_snapshot \"$2\"\n        ;;\n    restore)\n        restore_snapshot \"$2\"\n        ;;\n    list)\n        list_snapshots\n        ;;\n    *)\n        echo \"Usage: $0 {save|restore|list} [label]\"\n        echo \"\"\n        echo \"Examples:\"\n        echo \"  $0 save gold-2026-02-22        # Save with label\"\n        echo \"  $0 save                         # Save with timestamp\"\n        echo \"  $0 restore gold-2026-02-22      # Restore specific snapshot\"\n        echo \"  $0 restore                      # Restore 'latest'\"\n        echo \"  $0 list                         # List all snapshots\"\n        exit 1\n        ;;\nesac\n</code></pre> <p>Make executable:</p> <pre><code>chmod +x /root/clawd/scripts/restore-snapshot-config.sh\n</code></pre>"},{"location":"part5-hardening/#32-usage-examples","title":"3.2 Usage Examples","text":"<pre><code># Save current config with a descriptive label\n/root/clawd/scripts/restore-snapshot-config.sh save gold-2026-02-22\n\n# List all snapshots\n/root/clawd/scripts/restore-snapshot-config.sh list\n\n# Restore a specific snapshot\n/root/clawd/scripts/restore-snapshot-config.sh restore gold-2026-02-22\n\n# Restore latest (most recent save)\n/root/clawd/scripts/restore-snapshot-config.sh restore\n</code></pre> <p>Why: 3-second rollback when a config change breaks something</p>"},{"location":"part5-hardening/#33-gold-standard-practice","title":"3.3 Gold Standard Practice","text":"<p>After confirming everything works (all parts of this guide complete):</p> <pre><code># Test everything first\nopenclaw gateway status\nsystemctl status openclaw-webhook\nufw status\ncrontab -l\n\n# If all green, save your gold standard\n/root/clawd/scripts/restore-snapshot-config.sh save gold-2026-02-22-final\n</code></pre> <p>Why: This snapshot becomes your \"last known good\" state. If anything breaks in the future, restore this first.</p>"},{"location":"part5-hardening/#5-recovery-scripts-three-tier-system","title":"5. Recovery Scripts (Three-Tier System)","text":"<p>WHY: Failures have tiers. Config typo \u2260 corrupted install \u2260 dead server. Each tier needs a different recovery tool.</p>"},{"location":"part5-hardening/#41-tier-1-config-bricked-restore-snapshot-configsh","title":"4.1 Tier 1: Config Bricked (restore-snapshot-config.sh)","text":"<p>Scenario: You edited <code>openclaw.json</code> wrong, gateway won't start, or webhook config is broken.</p> <p>Solution: Restore last snapshot (covered in section 3)</p> <pre><code>/root/clawd/scripts/restore-snapshot-config.sh restore\nopenclaw gateway restart\nsystemctl restart openclaw-webhook\n</code></pre> <p>Time to recovery: 3 seconds What it restores: Config files only (openclaw.json, systemd services, SSH config, crontab, UFW rules)</p>"},{"location":"part5-hardening/#42-tier-2-openclaw-update-broke-things-restore-openclaw-installsh","title":"4.2 Tier 2: OpenClaw Update Broke Things (restore-openclaw-install.sh)","text":"<p>Scenario: <code>npm update -g openclaw</code> upgraded to a buggy version, gateway crashes, pairing fails.</p> <p>Solution: Restore previous OpenClaw version from backup</p> <p>Create the script:</p> <pre><code>nano /root/clawd/scripts/restore-openclaw-install.sh\n</code></pre> <pre><code>#!/bin/bash\n# restore-openclaw-install.sh - Restore previous OpenClaw version\n\nBACKUP_DIR=\"$HOME/.clawdbot/backups/openclaw\"\nLATEST_BACKUP=\"$BACKUP_DIR/latest\"\n\necho \"\u26a0\ufe0f  Rolling back OpenClaw installation...\"\n\n# Stop gateway\nopenclaw gateway stop 2&gt;/dev/null || true\n\n# Backup current version before downgrade\nCURRENT_VERSION=$(openclaw --version 2&gt;/dev/null || echo \"unknown\")\necho \"Current version: $CURRENT_VERSION\"\n\n# Check if backup exists\nif [ ! -d \"$LATEST_BACKUP\" ]; then\n    echo \"\u274c No backup found. Cannot restore.\"\n    echo \"   Backups should exist at: $BACKUP_DIR\"\n    exit 1\nfi\n\n# Uninstall current version\nnpm uninstall -g openclaw\n\n# Restore from backup (reinstall specific version)\nBACKUP_VERSION=$(cat \"$LATEST_BACKUP/version.txt\")\necho \"Restoring version: $BACKUP_VERSION\"\n\nnpm install -g openclaw@$BACKUP_VERSION\n\n# Restore config (if it was also affected)\nif [ -f \"$LATEST_BACKUP/config.json\" ]; then\n    cp \"$LATEST_BACKUP/config.json\" \"$HOME/.openclaw/config.json\"\n    echo \"  \u2713 Config restored from backup\"\nfi\n\n# Restart gateway\nopenclaw gateway start\n\necho \"\u2705 Rollback complete. Verify with: openclaw gateway status\"\n</code></pre> <p>Make executable:</p> <pre><code>chmod +x /root/clawd/scripts/restore-openclaw-install.sh\n</code></pre> <p>Why: Rollback to previous OpenClaw version when updates break things</p> <p>Time to recovery: 30 seconds What it restores: OpenClaw binary + config</p>"},{"location":"part5-hardening/#43-tier-3-server-is-dead-full-restoresh","title":"4.3 Tier 3: Server is Dead (full-restore.sh)","text":"<p>Scenario: VPS corrupted, need to rebuild from scratch on a new server.</p> <p>Solution: Full workspace restore from Google Drive backup</p> <p>Create the script:</p> <pre><code>nano /root/clawd/scripts/full-restore.sh\n</code></pre> <pre><code>#!/bin/bash\n# full-restore.sh - Full workspace restore from Google Drive\n\nBACKUP_NAME=\"clawd-workspace\"\nRESTORE_DIR=\"/root/clawd-restore\"\n\necho \"\ud83d\udd25 FULL RESTORE FROM GOOGLE DRIVE BACKUP\"\necho \"\u26a0\ufe0f  This should only be run on a FRESH server\"\nread -p \"Continue? (yes/no): \" confirm\n\nif [ \"$confirm\" != \"yes\" ]; then\n    echo \"Aborted.\"\n    exit 0\nfi\n\n# Install rclone if not present\nif ! command -v rclone &amp;&gt; /dev/null; then\n    echo \"Installing rclone...\"\n    curl https://rclone.org/install.sh | bash\nfi\n\n# Configure rclone (assumes you have the config)\nif [ ! -f \"$HOME/.config/rclone/rclone.conf\" ]; then\n    echo \"\u274c rclone not configured. Run: rclone config\"\n    exit 1\nfi\n\n# Pull latest backup from Google Drive\necho \"\ud83d\udce5 Downloading backup from Google Drive...\"\nmkdir -p \"$RESTORE_DIR\"\nrclone copy gdrive:openclaw-backups/$BACKUP_NAME.tar.gz \"$RESTORE_DIR/\"\n\n# Extract backup\ncd /root\ntar -xzf \"$RESTORE_DIR/$BACKUP_NAME.tar.gz\"\n\necho \"\u2705 Backup extracted to /root/clawd\"\n\n# Next steps\necho \"\"\necho \"Manual steps required:\"\necho \"1. Restore OpenClaw config: cp clawd/.openclaw/config.json ~/.openclaw/\"\necho \"2. Restore systemd services: cp clawd/systemd/* /etc/systemd/system/\"\necho \"3. Restore crontab: crontab clawd/crontab.txt\"\necho \"4. Install Node.js 22: curl -fsSL https://deb.nodesource.com/setup_22.x | bash &amp;&amp; apt install nodejs\"\necho \"5. Install OpenClaw: npm install -g openclaw\"\necho \"6. Start gateway: openclaw gateway start\"\necho \"7. Pair WhatsApp (will need new QR scan)\"\n</code></pre> <p>Make executable:</p> <pre><code>chmod +x /root/clawd/scripts/full-restore.sh\n</code></pre> <p>Why: Last resort for catastrophic failures (server crash, data corruption, migrate to new VPS)</p> <p>Time to recovery: 10-15 minutes What it restores: Entire workspace + instructions for service restoration</p>"},{"location":"part5-hardening/#44-post-recovery-checklist","title":"4.4 Post-Recovery Checklist","text":"<p>After ANY restore operation:</p> <pre><code># 1. Verify OpenClaw health\nopenclaw doctor\n\n# 2. Test gateway connectivity\nopenclaw gateway probe\n\n# 3. Send test message\n# (From your phone: send \"test\" to bot WhatsApp number)\n\n# 4. Check critical services\nsystemctl status openclaw-webhook crowdsec\n\n# 5. Verify backups still running\ncrontab -l | grep backup\n\n# 6. Save new snapshot after confirming recovery worked\n/root/clawd/scripts/restore-snapshot-config.sh save post-recovery-$(date +%Y%m%d)\n</code></pre> <p>Why: Confirms the restore actually worked and captures the recovered state</p>"},{"location":"part5-hardening/#6-safe-gateway-restart-protocol-critical","title":"6. Safe Gateway Restart Protocol (Critical)","text":"<p>WHY: Raw <code>openclaw gateway restart</code> can lose OpenClaw cron jobs (they're stored in memory during restart). You need a safe restart wrapper that backs up crons before restart and verifies after.</p>"},{"location":"part5-hardening/#61-create-safe-restart-script","title":"6.1 Create Safe Restart Script","text":"<pre><code>nano /root/clawd/scripts/safe-gateway-restart.sh\n</code></pre> <pre><code>#!/bin/bash\n# safe-gateway-restart.sh - ALWAYS use instead of raw \"openclaw gateway restart\"\n# Backs up crons before restart, verifies after, alerts on job loss\n\nset -e\n\necho \"\ud83d\udd04 Safe gateway restart starting...\"\n\n# Step 1: Backup current cron jobs\necho \"  \u2192 Backing up cron jobs...\"\nopenclaw cron list --json &gt; /root/.clawdbot/cron-backup-prerestart.json\nCRON_COUNT_BEFORE=$(openclaw cron list --json | jq '. jobs | length')\necho \"    \u2713 $CRON_COUNT_BEFORE jobs backed up\"\n\n# Step 2: Restart gateway\necho \"  \u2192 Restarting gateway...\"\nopenclaw gateway restart\n\n# Step 3: Wait for gateway to be ready\necho \"  \u2192 Waiting for gateway...\"\nsleep 5\n\n# Step 4: Verify cron jobs survived\nCRON_COUNT_AFTER=$(openclaw cron list --json | jq '.jobs | length')\necho \"    \u2713 $CRON_COUNT_AFTER jobs after restart\"\n\nif [ \"$CRON_COUNT_BEFORE\" != \"$CRON_COUNT_AFTER\" ]; then\n    echo \"\u274c CRON JOB LOSS DETECTED: $CRON_COUNT_BEFORE before, $CRON_COUNT_AFTER after\"\n    echo \"    Backup at: /root/.clawdbot/cron-backup-prerestart.json\"\n    echo \"    Manual recovery required: openclaw cron import &lt; backup.json\"\n    exit 1\nelse\n    echo \"\u2705 Safe restart complete. All $CRON_COUNT_AFTER cron jobs intact.\"\nfi\n</code></pre> <p>Make executable:</p> <pre><code>chmod +x /root/clawd/scripts/safe-gateway-restart.sh\n</code></pre> <p>Why: This wrapper ensures you never lose cron jobs during restart. Always use this instead of raw restart.</p>"},{"location":"part5-hardening/#62-usage","title":"6.2 Usage","text":"<p>NEVER do this: <pre><code>openclaw gateway restart  # \u274c UNSAFE \u2014 can lose crons\n</code></pre></p> <p>ALWAYS do this: <pre><code>/root/clawd/scripts/safe-gateway-restart.sh  # \u2705 SAFE\n</code></pre></p>"},{"location":"part5-hardening/#63-add-to-path-optional","title":"6.3 Add to PATH (Optional)","text":"<pre><code>echo 'export PATH=\"/root/clawd/scripts:$PATH\"' &gt;&gt; ~/.bashrc\nsource ~/.bashrc\n</code></pre> <p>Now you can just run: <pre><code>safe-gateway-restart.sh\n</code></pre></p> <p>Bookmark this: After every config change, use safe restart.</p>"},{"location":"part5-hardening/#7-device-scope-verification-prevent-whatsapp-pairing-loops","title":"7. Device Scope Verification (Prevent WhatsApp Pairing Loops)","text":"<p>WHY: OpenClaw 1.x introduced stricter device scope requirements. If your paired device doesn't have <code>operator.write</code> scope, pairing will loop forever (QR code \u2192 \"connected\" \u2192 immediately disconnects \u2192 new QR code).</p> <p>Reference: OpenClaw GitHub Issue #23006</p>"},{"location":"part5-hardening/#71-check-current-scope","title":"7.1 Check Current Scope","text":"<pre><code># View current device info\nopenclaw status\n</code></pre> <p>Look for the <code>devices</code> section:</p> <pre><code>{\n  \"devices\": [\n    {\n      \"id\": \"12345:67@s.whatsapp.net\",\n      \"scope\": \"operator.read\"   // \u274c Missing operator.write\n    }\n  ]\n}\n</code></pre> <p>Problem: Scope only has <code>operator.read</code>. OpenClaw now requires <code>operator.write</code> for message sending.</p>"},{"location":"part5-hardening/#72-fix-re-pair-with-correct-scope","title":"7.2 Fix: Re-pair with Correct Scope","text":"<p>If scope is missing <code>operator.write</code>:</p> <pre><code># 1. Stop gateway\nopenclaw gateway stop\n\n# 2. Remove old pairing\nrm -rf ~/.openclaw/auth_info_*\n\n# 3. Re-run setup (will generate new QR code)\nopenclaw setup\n\n# 4. Scan QR code from WhatsApp (Linked Devices \u2192 Link a Device)\n\n# 5. Verify scope after pairing\nopenclaw status\n</code></pre> <p>Correct output:</p> <pre><code>{\n  \"devices\": [\n    {\n      \"id\": \"12345:67@s.whatsapp.net\",\n      \"scope\": \"operator.read,operator.write\"   // \u2705 Both scopes present\n    }\n  ]\n}\n</code></pre>"},{"location":"part5-hardening/#73-symptoms-of-scope-issues","title":"7.3 Symptoms of Scope Issues","text":"<ul> <li>QR code scans successfully but disconnects within 2 seconds</li> <li>Gateway logs show \"device not authorized\" or \"missing scope\"</li> <li>Bot receives messages but can't send replies (sends fail silently)</li> <li>Pairing loop: QR \u2192 connected \u2192 disconnected \u2192 new QR \u2192 repeat</li> </ul> <p>Solution: Always re-pair (steps in 5.2) after major OpenClaw updates or if pairing loops occur.</p>"},{"location":"part5-hardening/#74-post-update-verification-routine","title":"7.4 Post-Update Verification Routine","text":"<p>After every <code>openclaw update</code>:</p> <pre><code># 1. Check version\nopenclaw --version\n\n# 2. Check gateway status\nopenclaw gateway status\n\n# 3. Verify device scope\nopenclaw status | grep scope\n\n# 4. Send test message to confirm send/receive works\n# (WhatsApp message from your phone to bot)\n\n# 5. If anything fails: re-pair (section 7.2)\n</code></pre> <p>Why: Catches scope issues before they cause production failures</p>"},{"location":"part5-hardening/#part-5-complete","title":"Part 5 Complete \u2705","text":"<p>You should now have:</p> <ul> <li>[ ] CrowdSec installed and monitoring logs</li> <li>[ ] Firewall bouncer active (bans are enforced)</li> <li>[ ] Active bans visible in <code>cscli decisions list</code></li> <li>[ ] Secret rotation schedule documented in <code>SECURITY.md</code></li> <li>[ ] Rotation procedures written for all critical secrets</li> <li>[ ] Rotation check script running daily (<code>rotation-check.py</code>)</li> <li>[ ] Config snapshot script created (<code>restore-snapshot-config.sh</code>)</li> <li>[ ] Gold standard snapshot saved</li> <li>[ ] Three recovery scripts created (Tier 1/2/3)</li> <li>[ ] Post-recovery checklist ready</li> <li>[ ] WhatsApp device scope verified (<code>operator.read,operator.write</code>)</li> <li>[ ] Post-update verification routine documented</li> </ul>"},{"location":"part5-hardening/#gold-standard-snapshot","title":"Gold Standard Snapshot","text":"<p>THIS IS THE MOMENT. Parts 1-5 are complete. Your system is production-ready. Save this state.</p> <pre><code># Final verification before snapshot\necho \"=== FINAL VERIFICATION ===\"\n\n# 1. OpenClaw\nopenclaw gateway status\nopenclaw status | grep scope\n\n# 2. Infrastructure\nsystemctl status openclaw-webhook crowdsec crowdsec-firewall-bouncer\n\n# 3. Backups\ncrontab -l | grep -E 'backup|verify'\n\n# 4. Security\nufw status\ncscli metrics\n\n# 5. Automation\nopenclaw cron list\n\n# If all green:\n/root/clawd/scripts/restore-snapshot-config.sh save gold-2026-02-22-final\n\necho \"\u2705 Gold standard saved. Future rollbacks: restore-snapshot-config.sh restore gold-2026-02-22-final\"\n</code></pre> <p>What you just saved: - OpenClaw config (WhatsApp pairing, persona, models) - All systemd services (webhook, backups, etc.) - SSH hardening settings - Firewall rules (UFW + CrowdSec) - All cron jobs (OC crons + system crontab)</p> <p>When to use it: - \"I changed something and now it's broken\" \u2192 Restore this snapshot - \"OpenClaw update caused issues\" \u2192 Restore snapshot, then use Tier 2 recovery - \"Starting a risky config change\" \u2192 Save new snapshot first, then proceed</p>"},{"location":"part5-hardening/#quick-reference-commands","title":"Quick Reference Commands","text":"<pre><code># CrowdSec\ncscli decisions list              # Active bans\ncscli metrics                     # Log processing stats\ncscli decisions delete --ip X.X.X.X   # Unban IP\n\n# Snapshots\nrestore-snapshot-config.sh save &lt;label&gt;    # Save snapshot\nrestore-snapshot-config.sh restore &lt;label&gt; # Restore snapshot\nrestore-snapshot-config.sh list            # List snapshots\n\n# Recovery\nrestore-snapshot-config.sh restore         # Tier 1: Config only\nrestore-openclaw-install.sh                # Tier 2: OpenClaw rollback\nfull-restore.sh                            # Tier 3: Full workspace\n\n# WhatsApp Scope\nopenclaw status | grep scope               # Check scope\nopenclaw setup                             # Re-pair if scope missing\n\n# Secret Rotation\nrotation-check.py                          # Check rotation schedule\nopenclaw gateway token --new               # Generate new gateway token\n\n# Post-Recovery\nopenclaw doctor                            # Health check\nopenclaw gateway probe                     # Connectivity test\nsystemctl status crowdsec openclaw-webhook  # Service status\n</code></pre> <p>Estimated time: 25-30 minutes</p> <p>Next: Part 6 \u2014 Verification (20-point checklist, full system validation)</p>"},{"location":"part6-verification/","title":"OpenClaw Installation Guide - Part 6: Verification (15 min)","text":"<p>Goal: Validate your entire OpenClaw setup end-to-end. This is the final checkpoint.</p> <p>Prerequisites:  - Parts 1-5 completed - Server is running - WhatsApp is paired</p>"},{"location":"part6-verification/#1-automated-verification-script","title":"1. Automated Verification Script","text":"<p>We've built a comprehensive verification script that checks all 20 critical points from Parts 1-5.</p>"},{"location":"part6-verification/#11-run-the-verification","title":"1.1 Run the Verification","text":"<pre><code>cd /root/clawd\npython3 scripts/verify-setup.py\n</code></pre> <p>What it checks:</p> Check Component What's Validated Part 1: Base Install 1 SSH Password auth disabled 2 Firewall UFW active, only SSH allowed 3 CrowdSec Service + bouncer running 4 Swap 2GB active Part 2: AI Assistant 5 Node.js v22.x installed 6 OpenClaw Binary installed 7 Gateway Service running 8 WhatsApp Channel configured 9 Device scope operator.read + operator.write 10 Workspace Core .md files exist 11 Models Primary + fallback configured Part 3: Infrastructure 12 Google OAuth token.json exists 13 Cloudflare Tunnel service running 14 Webhook server Service running, health OK 15 Public webhook HTTPS accessible Part 4: Automation 16 Backup crons Hourly + nightly scheduled 17 Rclone Google Drive remote configured 18 OC Crons At least 1 cron job 19 Event queue SQLite DB exists 20 Heartbeat HEARTBEAT.md exists Part 5: Hardening 21 Snapshots At least 1 config snapshot"},{"location":"part6-verification/#12-expected-output","title":"1.2 Expected Output","text":"<pre><code>============================================================\n           OpenClaw Setup Verification\n============================================================\n\nTimestamp: 2026-02-22 16:30:00 UTC\n\nPart 1: Base Install\n\u2705 SSH: Password auth disabled\n\u2705 Firewall: UFW active, SSH only\n\u2705 CrowdSec: Running + bouncer active\n\u2705 Swap: 2GB active\n\nPart 2: AI Assistant\n\u2705 Node.js: v22.x installed\n\u2705 OpenClaw: Installed\n\u2705 OpenClaw: Gateway running\n\u2705 WhatsApp: Connected\n\u2705 Device scope: operator.read + operator.write\n\u2705 Workspace: Core .md files exist\n\u2705 Models: Primary + fallback configured\n\nPart 3: Infrastructure\n\u2705 Google OAuth: token.json exists\n\u2705 Cloudflare tunnel: Running\n\u2705 Webhook server: Running\n\u2705 Public webhook: Accessible\n\nPart 4: Automation\n\u2705 Hourly + nightly crons\n\u2705 Rclone: Google Drive configured\n\u2705 OC Crons: At least 1 configured\n\u2705 Event queue: SQLite DB exists\n\u2705 Heartbeat: HEARTBEAT.md exists\n\nPart 5: Hardening\n\u2705 Config snapshot: At least 1 saved\n\n============================================================\n                      Summary\n============================================================\n\nPassed: 21/21 (100.0%)\n\n\ud83c\udf89 ALL CHECKS PASSED! Your OpenClaw setup is complete.\n</code></pre> <p>\u2705 Verify: All checks show \u2705 green checkmarks</p>"},{"location":"part6-verification/#2-manual-end-to-end-test","title":"2. Manual End-to-End Test","text":"<p>The automated script validates the infrastructure. Now let's validate the bot responds.</p>"},{"location":"part6-verification/#21-send-a-test-message","title":"2.1 Send a Test Message","text":"<p>From your phone (the one paired with WhatsApp):</p> <ol> <li>Open WhatsApp</li> <li> <p>Send a message to your bot number:    <pre><code>Hey, are you alive?\n</code></pre></p> </li> <li> <p>Wait 5-10 seconds</p> </li> </ol> <p>\u2705 Verify: Bot responds with a natural reply</p>"},{"location":"part6-verification/#22-test-a-command","title":"2.2 Test a Command","text":"<p>Send: <pre><code>What's the current UTC time?\n</code></pre></p> <p>\u2705 Verify: Bot responds with the correct time</p>"},{"location":"part6-verification/#23-test-file-access","title":"2.3 Test File Access","text":"<p>Send: <pre><code>Read SOUL.md and tell me what your primary directive is\n</code></pre></p> <p>\u2705 Verify: Bot reads the file and summarizes</p> <p>If any test fails, proceed to the Troubleshooting section below.</p>"},{"location":"part6-verification/#3-troubleshooting-reference","title":"3. Troubleshooting Reference","text":"<p>Quick lookup for common issues across all parts.</p>"},{"location":"part6-verification/#31-quick-reference-table","title":"3.1 Quick Reference Table","text":"Symptom Likely Cause Fix Can't SSH to server SSH service not running <code>systemctl restart sshd</code> \"Permission denied (publickey)\" SSH key not added to server Re-add key: <code>ssh-copy-id root@SERVER_IP</code> Gateway won't start Port conflict or bad config Check logs: <code>journalctl -u openclaw-gateway -n 50</code> WhatsApp disconnected QR code expired or phone offline Re-pair: <code>openclaw gateway restart</code>, scan QR Bot doesn't respond Gateway stopped or model API issue Check status: <code>systemctl status openclaw-gateway</code> \"Model rate limit\" Too many requests Wait 60s, or switch to fallback model Webhook not receiving Tunnel down or server crashed Restart: <code>systemctl restart cloudflared openclaw-webhook</code> Backup not running Cron misconfigured Check: <code>crontab -l</code>, verify paths Token expired Google OAuth needs refresh Re-auth: <code>scripts/google-reauth.py</code> \"Permission denied\" errors Wrong file ownership Fix: <code>chown -R root:root /root/clawd</code>"},{"location":"part6-verification/#32-top-10-common-issues","title":"3.2 Top 10 Common Issues","text":""},{"location":"part6-verification/#1-whatsapp-keeps-disconnecting","title":"1. WhatsApp Keeps Disconnecting","text":"<p>Symptom: Bot works for a few hours, then stops responding.</p> <p>Cause: Phone went offline, or WhatsApp logged out.</p> <p>Fix: <pre><code># Check gateway logs\njournalctl -u openclaw-gateway -n 100 | grep -i whatsapp\n\n# If disconnected, restart and re-pair\nopenclaw gateway restart\n</code></pre> Keep your phone online and WhatsApp open during initial setup.</p>"},{"location":"part6-verification/#2-gateway-fails-to-start","title":"2. Gateway Fails to Start","text":"<p>Symptom: <code>systemctl status openclaw-gateway</code> shows \"failed\" or \"inactive (dead)\"</p> <p>Cause: Usually bad <code>openclaw.json</code> syntax or missing API key.</p> <p>Fix: <pre><code># Check the exact error\njournalctl -u openclaw-gateway -n 50\n\n# Validate JSON syntax\ncat ~/.clawdbot/openclaw.json | jq .\n\n# If syntax error, edit and fix\nnano ~/.clawdbot/openclaw.json\n\n# Restart\nsystemctl restart openclaw-gateway\n</code></pre></p>"},{"location":"part6-verification/#3-model-not-found-or-api-errors","title":"3. \"Model not found\" or API Errors","text":"<p>Symptom: Bot responds with \"Model error\" or doesn't respond at all.</p> <p>Cause: Invalid API key, wrong model name, or API service down.</p> <p>Fix: <pre><code># Check logs for specific error\njournalctl -u openclaw-gateway -n 50 | grep -i error\n\n# Verify API key is set correctly in openclaw.json\ncat ~/.clawdbot/openclaw.json | jq '.model, .fallbackModel'\n\n# Test API key manually (for Anthropic)\ncurl https://api.anthropic.com/v1/messages \\\n  -H \"x-api-key: YOUR_KEY\" \\\n  -H \"anthropic-version: 2023-06-01\" \\\n  -H \"content-type: application/json\" \\\n  -d '{\"model\":\"claude-sonnet-4-5\",\"max_tokens\":10,\"messages\":[{\"role\":\"user\",\"content\":\"hi\"}]}'\n</code></pre></p>"},{"location":"part6-verification/#4-webhook-returns-404-or-502","title":"4. Webhook Returns 404 or 502","text":"<p>Symptom: Webhook URL returns error when visited.</p> <p>Cause: Cloudflare tunnel not running, or webhook server crashed.</p> <p>Fix: <pre><code># Check both services\nsystemctl status cloudflared\nsystemctl status openclaw-webhook\n\n# Check tunnel config\ncat ~/.cloudflared/config.yml\n\n# Restart both\nsystemctl restart cloudflared\nsystemctl restart openclaw-webhook\n\n# Test local webhook\ncurl http://127.0.0.1:8088/health\n# Should return: {\"status\":\"ok\"}\n</code></pre></p>"},{"location":"part6-verification/#5-backups-not-running","title":"5. Backups Not Running","text":"<p>Symptom: No recent backups in Google Drive, or cron emails about failures.</p> <p>Cause: Cron not scheduled, rclone not configured, or script permissions wrong.</p> <p>Fix: <pre><code># Check cron is scheduled\ncrontab -l | grep backup\n\n# Test hourly backup manually\n/root/clawd/backup.sh\n\n# Test nightly backup manually\n/root/clawd/scripts/nightly-backup.sh\n\n# Check rclone config\nrclone listremotes\n# Should show: gdrive:\n\n# Check recent backup files\nls -lh /root/openclaw-backups/\n</code></pre></p>"},{"location":"part6-verification/#6-google-oauth-token-expired","title":"6. Google OAuth Token Expired","text":"<p>Symptom: Calendar sync fails, or \"invalid_grant\" errors.</p> <p>Cause: Token expired or revoked.</p> <p>Fix: <pre><code># Re-authenticate\ncd /root/clawd\npython3 scripts/google-reauth.py\n\n# Follow the OAuth flow in browser\n# New token will be saved to ~/.clawdbot/google/token.json\n</code></pre></p>"},{"location":"part6-verification/#7-firewall-blocking-legitimate-traffic","title":"7. Firewall Blocking Legitimate Traffic","text":"<p>Symptom: Can't access webhook, or bot can't reach external APIs.</p> <p>Cause: UFW rule too restrictive.</p> <p>Fix: <pre><code># Check current rules\nufw status numbered\n\n# Allow outbound traffic (should be default, but verify)\nufw default allow outgoing\n\n# If you need to allow a specific inbound port:\nufw allow PORT_NUMBER/tcp\n\n# Reload\nufw reload\n</code></pre> Never open unnecessary inbound ports. Only SSH should be allowed.</p>"},{"location":"part6-verification/#8-out-of-disk-space","title":"8. Out of Disk Space","text":"<p>Symptom: Logs say \"no space left on device\", services fail.</p> <p>Cause: Logs filling disk, or too many backups.</p> <p>Fix: <pre><code># Check disk usage\ndf -h\n\n# Find large directories\ndu -sh /var/log/* | sort -h\ndu -sh /root/* | sort -h\n\n# Clear old logs\njournalctl --vacuum-time=7d\n\n# Delete old backups (keep last 7 days)\nfind /root/openclaw-backups/ -type f -mtime +7 -delete\n</code></pre></p>"},{"location":"part6-verification/#9-nodejs-version-mismatch","title":"9. Node.js Version Mismatch","text":"<p>Symptom: OpenClaw install fails, or runtime errors.</p> <p>Cause: Wrong Node.js version installed.</p> <p>Fix: <pre><code># Check current version\nnode --version\n\n# If not v22.x, reinstall\ncurl -fsSL https://deb.nodesource.com/setup_22.x | bash -\napt-get install -y nodejs\n\n# Verify\nnode --version\n# Should show: v22.x.x\n</code></pre></p>"},{"location":"part6-verification/#10-crowdsec-blocking-legitimate-ips","title":"10. CrowdSec Blocking Legitimate IPs","text":"<p>Symptom: Can't SSH from your IP, or bot's outbound requests blocked.</p> <p>Cause: CrowdSec false positive.</p> <p>Fix: <pre><code># Check decisions (active bans)\ncscli decisions list\n\n# If your IP is banned, unban it\ncscli decisions delete --ip YOUR_IP\n\n# Whitelist your IP permanently\ncscli decisions add --ip YOUR_IP --duration 999999h --type captcha\n\n# Or disable bouncer temporarily\nsystemctl stop crowdsec-firewall-bouncer\n</code></pre></p>"},{"location":"part6-verification/#4-full-config-reference","title":"4. Full Config Reference","text":"<p>Here's an annotated <code>openclaw.json</code> showing all key fields. Do not copy values verbatim \u2014 this is a structure reference.</p>"},{"location":"part6-verification/#41-complete-structure","title":"4.1 Complete Structure","text":"<pre><code>{\n  \"model\": \"anthropic/claude-opus-4-6\",\n  \"fallbackModel\": \"google/gemini-2.5-pro\",\n  \"contextTokens\": 200000,\n\n  \"deviceScope\": [\n    \"operator.read\",\n    \"operator.write\"\n  ],\n\n  \"workspaceRoot\": \"/root/clawd\",\n\n  \"channels\": [\n    {\n      \"type\": \"whatsapp\",\n      \"sessionName\": \"default\",\n      \"autoReconnect\": true\n    }\n  ],\n\n  \"heartbeat\": {\n    \"enabled\": true,\n    \"intervalMs\": 3600000,\n    \"checkPath\": \"/root/clawd/HEARTBEAT.md\"\n  },\n\n  \"crons\": [\n    {\n      \"name\": \"morning-brief\",\n      \"schedule\": \"0 9 * * *\",\n      \"command\": \"python3 /root/clawd/scripts/morning-brief.py\",\n      \"deliverTo\": \"whatsapp\",\n      \"model\": \"claude-sonnet-4-0\"\n    }\n  ],\n\n  \"safety\": {\n    \"maxTokensPerRequest\": 4096,\n    \"rateLimitPerMinute\": 60\n  },\n\n  \"systemPrompt\": {\n    \"files\": [\n      \"/root/clawd/AGENTS.md\",\n      \"/root/clawd/SOUL.md\"\n    ]\n  }\n}\n</code></pre>"},{"location":"part6-verification/#42-key-field-explanations","title":"4.2 Key Field Explanations","text":"Field Purpose Example Value <code>model</code> Primary AI model <code>anthropic/claude-opus-4-6</code> <code>fallbackModel</code> Backup if primary fails <code>google/gemini-2.5-pro</code> <code>contextTokens</code> Max context window <code>200000</code> (200K) <code>deviceScope</code> Permissions for OpenClaw <code>[\"operator.read\", \"operator.write\"]</code> <code>workspaceRoot</code> Agent's home directory <code>/root/clawd</code> <code>channels</code> Communication platforms WhatsApp, Discord, Telegram, etc. <code>heartbeat.enabled</code> Auto-check-in system <code>true</code> <code>heartbeat.intervalMs</code> Time between heartbeats <code>3600000</code> (1 hour) <code>crons</code> Scheduled tasks Morning brief, standup, etc. <code>safety.maxTokensPerRequest</code> Token limit per response <code>4096</code> <code>systemPrompt.files</code> Files injected into every prompt <code>AGENTS.md</code>, <code>SOUL.md</code>"},{"location":"part6-verification/#43-model-configuration","title":"4.3 Model Configuration","text":"<p>Recommended Tiers:</p> Use Case Model Context Cost Main session <code>claude-opus-4-6</code> 200K High Sub-agents <code>claude-sonnet-4-5</code> 200K Medium Cron jobs <code>claude-sonnet-4-0</code> 200K Low Fallback <code>google/gemini-2.5-pro</code> 1M+ Low <p>Important: Set <code>contextTokens</code> to the smallest context window in your chain. If your fallback has 200K but primary has 1M, use <code>200000</code>.</p>"},{"location":"part6-verification/#5-whats-next","title":"5. What's Next?","text":"<p>You've built the infrastructure. Now make it yours.</p>"},{"location":"part6-verification/#51-customize-your-persona","title":"5.1 Customize Your Persona","text":"<p>Edit <code>/root/clawd/SOUL.md</code> to define your bot's personality:</p> <pre><code>nano /root/clawd/SOUL.md\n</code></pre> <p>Suggested sections: - Core directive: What's your bot's primary purpose? - Tone: Formal? Casual? Sarcastic? - Boundaries: What should it refuse to do? - Expertise: What domains is it expert in?</p> <p>Example: <pre><code># SOUL.md\n\n## Primary Directive\nI am MyBot, your executive assistant. My purpose is to:\n1. Manage his calendar and priorities\n2. Handle research and data gathering\n3. Draft communications\n4. Monitor systems and alert on issues\n\n## Tone\nProfessional but warm. I use first person (\"I checked the calendar\").\nDirect and concise \u2014 no fluff.\n\n## Boundaries\nI do not:\n- Make financial decisions without confirmation\n- Send external messages without review\n- Delete data without asking\n</code></pre></p>"},{"location":"part6-verification/#52-build-daily-rhythms","title":"5.2 Build Daily Rhythms","text":"<p>Create routines using cron jobs:</p> <p>Morning Brief (9am UTC): <pre><code># /root/clawd/scripts/morning-brief.py\n# - Check calendar for today\n# - Summarize unread emails\n# - Review yesterday's memory log\n# - Send via WhatsApp\n</code></pre></p> <p>Standup (10am UTC, weekdays only): <pre><code># /root/clawd/scripts/standup.py\n# - List today's scheduled tasks\n# - Check active projects\n# - Suggest priorities\n</code></pre></p> <p>Evening Wrap (6pm UTC): <pre><code># /root/clawd/scripts/evening-wrap.py\n# - Summarize what happened today\n# - Write to daily memory log\n# - Prep tomorrow's agenda\n</code></pre></p> <p>Add to <code>openclaw.json</code>: <pre><code>\"crons\": [\n  {\n    \"name\": \"morning-brief\",\n    \"schedule\": \"0 9 * * *\",\n    \"command\": \"python3 /root/clawd/scripts/morning-brief.py\",\n    \"deliverTo\": \"whatsapp\"\n  },\n  {\n    \"name\": \"standup\",\n    \"schedule\": \"0 10 * * 1-5\",\n    \"command\": \"python3 /root/clawd/scripts/standup.py\",\n    \"deliverTo\": \"whatsapp\"\n  },\n  {\n    \"name\": \"evening-wrap\",\n    \"schedule\": \"0 18 * * *\",\n    \"command\": \"python3 /root/clawd/scripts/evening-wrap.py\",\n    \"deliverTo\": \"whatsapp\"\n  }\n]\n</code></pre></p>"},{"location":"part6-verification/#53-email-integration","title":"5.3 Email Integration","text":"<p>Option 1: AgentMail (Dead Simple) 1. Sign up at agentmail.to 2. Get your bot email: <code>yourname@agentmail.to</code> 3. Configure webhook in AgentMail settings 4. Point to: <code>https://webhook.yourdomain.com/agentmail/YOUR_SECRET</code> 5. Bot receives emails, processes via event queue</p> <p>Option 2: Gmail API (Full Control) 1. Already set up if you completed Part 3 2. Use <code>scripts/gmail-check.py</code> to poll inbox 3. Run via cron every 15 minutes 4. Process new emails, summarize, alert</p>"},{"location":"part6-verification/#54-create-custom-skills","title":"5.4 Create Custom Skills","text":"<p>Skills are reusable tools your bot can invoke.</p> <p>Example: Weather Lookup</p> <pre><code># /root/clawd/skills/weather.py\nimport requests\nimport sys\n\ndef get_weather(city):\n    api_key = \"YOUR_OPENWEATHER_API_KEY\"\n    url = f\"http://api.openweathermap.org/data/2.5/weather?q={city}&amp;appid={api_key}\"\n    response = requests.get(url)\n    data = response.json()\n\n    temp_k = data['main']['temp']\n    temp_c = temp_k - 273.15\n    description = data['weather'][0]['description']\n\n    return f\"{city}: {temp_c:.1f}\u00b0C, {description}\"\n\nif __name__ == \"__main__\":\n    city = sys.argv[1] if len(sys.argv) &gt; 1 else \"Your City\"\n    print(get_weather(city))\n</code></pre> <p>How to use: 1. Save to <code>/root/clawd/skills/weather.py</code> 2. Make executable: <code>chmod +x /root/clawd/skills/weather.py</code> 3. Document in <code>/root/clawd/TOOLS.md</code>:    <pre><code>## Weather\n`python3 skills/weather.py \"City Name\"`\nReturns current weather for any city.\n</code></pre> 4. Bot can now call it: <code>python3 skills/weather.py \"London\"</code></p>"},{"location":"part6-verification/#55-join-the-community","title":"5.5 Join the Community","text":"<p>Get help, share your setup, contribute back:</p> <ul> <li>GitHub: openclaw/openclaw</li> <li>Discord: discord.gg/openclaw</li> <li>Forum: discuss.openclaw.dev</li> </ul> <p>Ways to contribute: - Share your custom skills - Report bugs or suggest features - Write guides for specific integrations - Help other users troubleshoot</p>"},{"location":"part6-verification/#6-setup-complete","title":"6. \ud83c\udf89 Setup Complete!","text":"<p>You did it. You've built a production-grade AI assistant from scratch.</p>"},{"location":"part6-verification/#what-youve-accomplished","title":"What You've Accomplished","text":"<p>\u2705 Hardened VPS \u2014 SSH lockdown, firewall, intrusion detection \u2705 AI Brain \u2014 GPT-4-class model with fallback \u2705 WhatsApp Interface \u2014 Chat with your bot anytime, anywhere \u2705 Calendar Integration \u2014 Google Calendar sync, reminders, red-flagging \u2705 Email Routing \u2014 Webhook-based email processing \u2705 Automated Backups \u2014 Hourly code, nightly full system \u2705 Self-Monitoring \u2014 Heartbeats, health checks, event queue \u2705 Recovery System \u2014 Config snapshots, rollback scripts  </p>"},{"location":"part6-verification/#your-bot-can-now","title":"Your Bot Can Now","text":"<ul> <li>Read and write files in its workspace</li> <li>Search the web for real-time information</li> <li>Manage your calendar (create, edit, alert)</li> <li>Process emails and draft replies</li> <li>Run shell commands (safely, with oversight)</li> <li>Schedule tasks via cron</li> <li>Monitor itself and alert on failures</li> <li>Recover from crashes automatically</li> </ul>"},{"location":"part6-verification/#the-real-work-starts-now","title":"The Real Work Starts Now","text":"<p>The infrastructure is done. Now you teach it how you work.</p> <ul> <li>Fill <code>USER.md</code> with your preferences, quirks, pet peeves</li> <li>Log everything in daily memory files</li> <li>Give feedback when it misses the mark</li> <li>Build routines that match your day</li> </ul> <p>This is not a tool. It's a teammate.</p> <p>Treat it like one. It'll learn your style, anticipate your needs, handle the boring stuff, and give you hours back.</p>"},{"location":"part6-verification/#final-checklist","title":"Final Checklist","text":"<p>Before you close this guide:</p> <ul> <li>[ ] All 21 verification checks passed</li> <li>[ ] Bot responds to WhatsApp messages</li> <li>[ ] <code>SOUL.md</code> reflects your bot's purpose</li> <li>[ ] At least one cron job configured</li> <li>[ ] Backups confirmed in Google Drive</li> <li>[ ] You know how to check logs: <code>journalctl -u openclaw-gateway -n 50</code></li> <li>[ ] You bookmarked the troubleshooting table</li> <li>[ ] You know how to restore a snapshot: <code>scripts/restore-snapshot-config.sh</code></li> </ul>"},{"location":"part6-verification/#support-resources","title":"Support &amp; Resources","text":"<p>Documentation: - Full OpenClaw docs: docs.openclaw.ai - Source: github.com/openclaw/openclaw - Community: Discord - Skills: clawhub.com</p> <p>Quick Commands: <pre><code># Check gateway status\nsystemctl status openclaw-gateway\n\n# Restart gateway\nsystemctl restart openclaw-gateway\n\n# View recent logs\njournalctl -u openclaw-gateway -n 100 -f\n\n# Re-run verification\npython3 /root/clawd/scripts/verify-setup.py\n\n# Restore config snapshot\n/root/clawd/scripts/restore-snapshot-config.sh\n\n# Test webhook health\ncurl http://127.0.0.1:8088/health\n</code></pre></p> <p>Emergency Recovery: <pre><code># If everything is broken:\ncd /root/clawd\ngit pull\nsystemctl restart openclaw-gateway\n\n# If config is corrupted:\n/root/clawd/scripts/restore-snapshot-config.sh\n\n# If OpenClaw won't start:\njournalctl -u openclaw-gateway -n 100\n# Fix the error shown, then restart\n</code></pre></p> <p>Thank you for building with OpenClaw.</p> <p>Now go build something incredible. \ud83d\ude80</p> <p>Last updated: 2026-02-22 Guide version: 1.0 OpenClaw version: Latest stable</p>"}]}